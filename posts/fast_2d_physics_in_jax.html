<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2023-01-08">

<title>RLog2 - Jaxで高速な2D物理シミュレーションを実装してみる</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script type="application/json" class="js-hypothesis-config">
{
  "theme": "clean"
}
</script>
<script async="" src="https://hypothes.is/embed.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">RLog2</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html" rel="" target="">
 <span class="menu-text">RLog2: RL blog 2</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://sigmoid.social/@kngwyu" rel="" target=""><i class="bi bi-mastodon" role="img">
</i> 
 <span class="menu-text">Mastodon</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/kngwyu" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text">Github</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Jaxで高速な2D物理シミュレーションを実装してみる</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">ja</div>
                <div class="quarto-category">RL</div>
                <div class="quarto-category">physics</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">January 8, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#semi-implicit-eulerで物体を動かす" id="toc-semi-implicit-eulerで物体を動かす" class="nav-link active" data-scroll-target="#semi-implicit-eulerで物体を動かす">Semi-implicit Eulerで物体を動かす</a>
  <ul class="collapse">
  <li><a href="#衝突判定を行う" id="toc-衝突判定を行う" class="nav-link" data-scroll-target="#衝突判定を行う">衝突判定を行う</a></li>
  <li><a href="#衝突した後どうすればいいの" id="toc-衝突した後どうすればいいの" class="nav-link" data-scroll-target="#衝突した後どうすればいいの">衝突した後どうすればいいの</a></li>
  <li><a href="#線分" id="toc-線分" class="nav-link" data-scroll-target="#線分">線分</a></li>
  </ul></li>
  <li><a href="#まとめ" id="toc-まとめ" class="nav-link" data-scroll-target="#まとめ">まとめ</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p>GPU上での高速な物理シミュレーションは、(RLHFやOffline RLに押され気味とはいえ)強化学習界隈では話題のトピックですよね。また単純に、GPU上で爆速でシミュレーションが終わるのはなかなか楽しいものです。 <a href="https://docs.omniverse.nvidia.com/index.html">NVIDIA IsaacSym</a>もありますが、jaxで強化学習パイプライン全体を高速化したいなら<a href="https://github.com/google/brax">brax</a>が便利です。以前<a href="https://kngwyu.github.io/rlog2/posts/jax-brax-haiku.html">紹介するブログ</a>も書きましたが、現在のバージョンではより精度のいい手法が選べるようになっていて、普通にMuJoCoの代わりに使えそうな感じです。しかし、最近単純な2次元物理シミュレーションでbraxが使えないかな？と思って検討してみたところ、無理ではないのだけれどどうにも使いづらいな…という印象でした。また、二次元物理シミュレーションをするのに、三次元のボールとかで当たり判定を行うのはちょっと計算資源がもったいない気もします。なら自分で作ってしまえばいいんじゃないか？ということでやってみました。</p>
<section id="semi-implicit-eulerで物体を動かす" class="level1">
<h1>Semi-implicit Eulerで物体を動かす</h1>
<p>とりあえず、衝突のことはいったん忘れて、物体を動かしてみましょう。物体の位置・速度を<span class="math inline">\(x, v\)</span>、その時間微分を<span class="math inline">\(\dot{x} = \frac{dx}{dt}, \dot{v} = \frac{dv}{dt}\)</span>とおきます。ニュートンの運動の第二法則から、<span class="math inline">\(F(t) = m \frac{d^2 x}{dt^2}(t)\)</span>ですから、最も単純な速度・位置更新の近似は、適当な十分短い時間間隔<span class="math inline">\(\Delta t\)</span>をとって、</p>
<p><span class="math display">\[
\dot{x}_{t + 1} = \dot{v}_t \Delta t \\
\dot{v}_{t + 1} = \frac{F}{m} \Delta t
\]</span></p>
<p>と表せます（Explicit Euler)。これは不安定になるので、今回は安定しやすい<a href="https://en.wikipedia.org/wiki/Semi-implicit_Euler_method">Semi-implicit Euler</a>を使います。これはアルゴリズム上はすごく単純で、</p>
<p><span class="math display">\[
\dot{v}_{t + 1} = \frac{F}{m} \Delta t \\
\dot{x}_{t + 1} = \dot{v}_{t + 1} \Delta t
\]</span></p>
<p>とすればいいです。</p>
<p>まず<code>Velocity</code>など、必要なものを適当に定義しておきます。剛体ですが、とりあえずこの世界には丸いものしかないことにして、<code>Circle</code>だけ定義しましょう。</p>
<div class="cell" data-tags="[]" data-execution_count="1">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Any, Protocol, Sequence</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> chex</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> jax</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> jax.numpy <span class="im">as</span> jnp</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>Self <span class="op">=</span> Any</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> PyTreeOps:</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__add__</span>(<span class="va">self</span>, o: Any) <span class="op">-&gt;</span> Self:</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> o.__class__ <span class="kw">is</span> <span class="va">self</span>.__class__:</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> jax.tree_map(<span class="kw">lambda</span> x, y: x <span class="op">+</span> y, <span class="va">self</span>, o)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> jax.tree_map(<span class="kw">lambda</span> x: x <span class="op">+</span> o, <span class="va">self</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__sub__</span>(<span class="va">self</span>, o: Any) <span class="op">-&gt;</span> Self:</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> o.__class__ <span class="kw">is</span> <span class="va">self</span>.__class__:</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> jax.tree_map(<span class="kw">lambda</span> x, y: x <span class="op">-</span> y, <span class="va">self</span>, o)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> jax.tree_map(<span class="kw">lambda</span> x: x <span class="op">-</span> o, <span class="va">self</span>)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__mul__</span>(<span class="va">self</span>, o: <span class="bu">float</span> <span class="op">|</span> jax.Array) <span class="op">-&gt;</span> Self:</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> jax.tree_map(<span class="kw">lambda</span> x: x <span class="op">*</span> o, <span class="va">self</span>)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__neg__</span>(<span class="va">self</span>) <span class="op">-&gt;</span> Self:</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> jax.tree_map(<span class="kw">lambda</span> x: <span class="op">-</span>x, <span class="va">self</span>)</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__truediv__</span>(<span class="va">self</span>, o: <span class="bu">float</span> <span class="op">|</span> jax.Array) <span class="op">-&gt;</span> Self:</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> jax.tree_map(<span class="kw">lambda</span> x: x <span class="op">/</span> o, <span class="va">self</span>)</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_slice(</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>,</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>        index: <span class="bu">int</span> <span class="op">|</span> Sequence[<span class="bu">int</span>] <span class="op">|</span> Sequence[<span class="bu">bool</span>] <span class="op">|</span> jax.Array,</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">-&gt;</span> Self:</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> jax.tree_map(<span class="kw">lambda</span> x: x[index], <span class="va">self</span>)</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> reshape(<span class="va">self</span>, shape: Sequence[<span class="bu">int</span>]) <span class="op">-&gt;</span> Self:</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> jax.tree_map(<span class="kw">lambda</span> x: x.reshape(shape), <span class="va">self</span>)</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="bu">sum</span>(<span class="va">self</span>, axis: <span class="bu">int</span> <span class="op">|</span> <span class="va">None</span> <span class="op">=</span> <span class="va">None</span>) <span class="op">-&gt;</span> Self:</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> jax.tree_map(<span class="kw">lambda</span> x: jnp.<span class="bu">sum</span>(x, axis<span class="op">=</span>axis), <span class="va">self</span>)</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> tolist(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">list</span>[Self]:</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>        leaves, treedef <span class="op">=</span> jax.tree_util.tree_flatten(<span class="va">self</span>)</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> [treedef.unflatten(leaf) <span class="cf">for</span> leaf <span class="kw">in</span> <span class="bu">zip</span>(<span class="op">*</span>leaves)]</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> zeros_like(<span class="va">self</span>) <span class="op">-&gt;</span> Any:</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> jax.tree_map(<span class="kw">lambda</span> x: jnp.zeros_like(x), <span class="va">self</span>)</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> shape(<span class="va">self</span>) <span class="op">-&gt;</span> Any:</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""For debugging"""</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> jax.tree_map(<span class="kw">lambda</span> x: x.shape, <span class="va">self</span>)</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>TWO_PI <span class="op">=</span> jnp.pi <span class="op">*</span> <span class="dv">2</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> _PositionLike(Protocol):</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>    angle: jax.Array  <span class="co"># Angular velocity (N,)</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>    xy: jax.Array  <span class="co"># (N, 2)</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, angle: jax.Array, xy: jax.Array) <span class="op">-&gt;</span> Self:</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>        ...</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> batch_size(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.angle.shape[<span class="dv">0</span>]</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">@classmethod</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> zeros(cls: <span class="bu">type</span>[Self], n: <span class="bu">int</span>) <span class="op">-&gt;</span> Self:</span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> cls(angle<span class="op">=</span>jnp.zeros((n,)), xy<span class="op">=</span>jnp.zeros((n, <span class="dv">2</span>)))</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a><span class="at">@chex.dataclass</span></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Velocity(_PositionLike, PyTreeOps):</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>    angle: jax.Array  <span class="co"># Angular velocity (N,)</span></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>    xy: jax.Array  <span class="co"># (N, 2)</span></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a><span class="at">@chex.dataclass</span></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Force(_PositionLike, PyTreeOps):</span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>    angle: jax.Array  <span class="co"># Angular (torque) force (N,)</span></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>    xy: jax.Array  <span class="co"># (N, 2)</span></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _get_xy(xy: jax.Array) <span class="op">-&gt;</span> <span class="bu">tuple</span>[jax.Array, jax.Array]:</span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> jax.lax.slice_in_dim(xy, <span class="dv">0</span>, <span class="dv">1</span>, axis<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> jax.lax.slice_in_dim(xy, <span class="dv">1</span>, <span class="dv">2</span>, axis<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> jax.lax.squeeze(x, (<span class="op">-</span><span class="dv">1</span>,)), jax.lax.squeeze(y, (<span class="op">-</span><span class="dv">1</span>,))</span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a><span class="at">@chex.dataclass</span></span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Position(_PositionLike, PyTreeOps):</span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>    angle: jax.Array  <span class="co"># Angular velocity (N, 1)</span></span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>    xy: jax.Array  <span class="co"># (N, 2)</span></span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> rotate(<span class="va">self</span>, xy: jax.Array) <span class="op">-&gt;</span> jax.Array:</span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>        x, y <span class="op">=</span> _get_xy(xy)</span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>        s, c <span class="op">=</span> jnp.sin(<span class="va">self</span>.angle), jnp.cos(<span class="va">self</span>.angle)</span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>        rot_x <span class="op">=</span> c <span class="op">*</span> x <span class="op">-</span> s <span class="op">*</span> y</span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>        rot_y <span class="op">=</span> s <span class="op">*</span> x <span class="op">+</span> c <span class="op">*</span> y</span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> jnp.stack((rot_x, rot_y), axis<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> transform(<span class="va">self</span>, xy: jax.Array) <span class="op">-&gt;</span> jax.Array:</span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.rotate(xy) <span class="op">+</span> <span class="va">self</span>.xy</span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> inv_rotate(<span class="va">self</span>, xy: jax.Array) <span class="op">-&gt;</span> jax.Array:</span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>        x, y <span class="op">=</span> _get_xy(xy)</span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>        s, c <span class="op">=</span> jnp.sin(<span class="va">self</span>.angle), jnp.cos(<span class="va">self</span>.angle)</span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>        rot_x <span class="op">=</span> c <span class="op">*</span> x <span class="op">+</span> s <span class="op">*</span> y</span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>        rot_y <span class="op">=</span> c <span class="op">*</span> y <span class="op">-</span> s <span class="op">*</span> x</span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> jnp.stack((rot_x, rot_y), axis<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> inv_transform(<span class="va">self</span>, xy: jax.Array) <span class="op">-&gt;</span> jax.Array:</span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.inv_rotate(xy <span class="op">-</span> <span class="va">self</span>.xy)</span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a><span class="at">@chex.dataclass</span></span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Shape(PyTreeOps):</span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>    mass: jax.Array</span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a>    moment: jax.Array</span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>    elasticity: jax.Array</span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>    friction: jax.Array</span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>    rgba: jax.Array</span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> inv_mass(<span class="va">self</span>) <span class="op">-&gt;</span> jax.Array:</span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""To support static shape, set let inv_mass 0 if mass is infinite"""</span></span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a>        m <span class="op">=</span> <span class="va">self</span>.mass</span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> jnp.where(jnp.isfinite(m), <span class="fl">1.0</span> <span class="op">/</span> m, jnp.zeros_like(m))</span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> inv_moment(<span class="va">self</span>) <span class="op">-&gt;</span> jax.Array:</span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""As inv_mass does, set inv_moment 0 if moment is infinite"""</span></span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a>        m <span class="op">=</span> <span class="va">self</span>.moment</span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> jnp.where(jnp.isfinite(m), <span class="fl">1.0</span> <span class="op">/</span> m, jnp.zeros_like(m))</span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> to_shape(<span class="va">self</span>) <span class="op">-&gt;</span> Self:</span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Shape(</span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a>            mass<span class="op">=</span><span class="va">self</span>.mass,</span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a>            moment<span class="op">=</span><span class="va">self</span>.moment,</span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a>            elasticity<span class="op">=</span><span class="va">self</span>.elasticity,</span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a>            friction<span class="op">=</span><span class="va">self</span>.friction,</span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a>            rgba<span class="op">=</span><span class="va">self</span>.rgba,</span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a><span class="at">@chex.dataclass</span></span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Circle(Shape):</span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a>    radius: jax.Array</span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a><span class="at">@chex.dataclass</span></span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> State(PyTreeOps):</span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a>    p: Position</span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a>    v: Velocity</span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a>    f: Force</span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a>    is_active: jax.Array</span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a><span class="at">@chex.dataclass</span></span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Space:</span>
<span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a>    gravity: jax.Array</span>
<span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a>    circle: Circle</span>
<span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a>    dt: jax.Array <span class="op">|</span> <span class="bu">float</span> <span class="op">=</span> <span class="fl">0.1</span></span>
<span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a>    linear_damping: jax.Array <span class="op">|</span> <span class="bu">float</span> <span class="op">=</span> <span class="fl">0.95</span></span>
<span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a>    angular_damping: jax.Array <span class="op">|</span> <span class="bu">float</span> <span class="op">=</span> <span class="fl">0.95</span></span>
<span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a>    bias_factor: jax.Array <span class="op">|</span> <span class="bu">float</span> <span class="op">=</span> <span class="fl">0.2</span></span>
<span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a>    n_velocity_iter: <span class="bu">int</span> <span class="op">=</span> <span class="dv">8</span></span>
<span id="cb1-169"><a href="#cb1-169" aria-hidden="true" tabindex="-1"></a>    n_position_iter: <span class="bu">int</span> <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb1-170"><a href="#cb1-170" aria-hidden="true" tabindex="-1"></a>    linear_slop: jax.Array <span class="op">|</span> <span class="bu">float</span> <span class="op">=</span> <span class="fl">0.005</span></span>
<span id="cb1-171"><a href="#cb1-171" aria-hidden="true" tabindex="-1"></a>    max_linear_correction: jax.Array <span class="op">|</span> <span class="bu">float</span> <span class="op">=</span> <span class="fl">0.2</span></span>
<span id="cb1-172"><a href="#cb1-172" aria-hidden="true" tabindex="-1"></a>    allowed_penetration: jax.Array <span class="op">|</span> <span class="bu">float</span> <span class="op">=</span> <span class="fl">0.005</span></span>
<span id="cb1-173"><a href="#cb1-173" aria-hidden="true" tabindex="-1"></a>    bounce_threshold: <span class="bu">float</span> <span class="op">=</span> <span class="fl">1.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>次は描画用の関数を準備しましょう。</p>
<div class="cell" data-tags="[]" data-execution_count="2">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Iterable</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot <span class="im">as</span> plt</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.axes <span class="im">import</span> Axes</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.patches <span class="im">import</span> Circle <span class="im">as</span> CirclePatch</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib ipympl</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>plt.ioff()</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> visualize_balls(ax: Axes, circles: Circle, positions: Iterable[Position]) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    pos <span class="op">=</span> <span class="bu">list</span>(positions)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    circle_list <span class="op">=</span> circles.tolist()</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> pi <span class="kw">in</span> pos:</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> pij, circle <span class="kw">in</span> <span class="bu">zip</span>(pi.tolist(), circle_list):</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>            circle_patch <span class="op">=</span> CirclePatch(</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>                xy<span class="op">=</span>pij.xy,</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>                radius<span class="op">=</span>circle.radius,</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>                fill<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>                color<span class="op">=</span>circle.rgba.tolist(),</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>            ax.add_patch(circle_patch)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Semi-implicit Eulerを実装します。</p>
<div class="cell" data-tags="[]" data-execution_count="45">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> update_velocity(space: Space, shape: Shape, state: State) <span class="op">-&gt;</span> State:</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Expand (N, ) to (N, 1) because xy has a shape (N, 2)</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    invm <span class="op">=</span> jnp.expand_dims(shape.inv_mass(), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    gravity <span class="op">=</span> jnp.where(</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        jnp.logical_and(invm <span class="op">&gt;</span> <span class="dv">0</span>, jnp.expand_dims(state.is_active, axis<span class="op">=</span><span class="dv">1</span>)),</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        space.gravity <span class="op">*</span> jnp.ones_like(state.v.xy),</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>        jnp.zeros_like(state.v.xy),</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    v_xy <span class="op">=</span> state.v.xy <span class="op">+</span> (gravity <span class="op">+</span> state.f.xy <span class="op">*</span> invm) <span class="op">*</span> space.dt</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    v_ang <span class="op">=</span> state.v.angle <span class="op">+</span> state.f.angle <span class="op">*</span> shape.inv_moment() <span class="op">*</span> space.dt</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Damping: dv/dt + vc = 0 -&gt; v(t) = v0 * exp(-tc)</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># v(t + dt) = v0 * exp(-tc - dtc) = v0 * exp(-tc) * exp(-dtc) = v(t)exp(-dtc)</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Thus, linear/angular damping factors are actually exp(-dtc)</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> state.replace(</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>        v<span class="op">=</span>Velocity(angle<span class="op">=</span>v_ang <span class="op">*</span> space.angular_damping, xy<span class="op">=</span>v_xy <span class="op">*</span> space.linear_damping),</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>        f<span class="op">=</span>state.f.zeros_like(),</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> update_position(space: Space, state: State) <span class="op">-&gt;</span> State:</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    v_dt <span class="op">=</span> state.v <span class="op">*</span> space.dt</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    xy <span class="op">=</span> state.p.xy <span class="op">+</span> v_dt.xy</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    angle <span class="op">=</span> (state.p.angle <span class="op">+</span> v_dt.angle <span class="op">+</span> TWO_PI) <span class="op">%</span> TWO_PI</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> state.replace(p<span class="op">=</span>Position(angle<span class="op">=</span>angle, xy<span class="op">=</span>xy))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>とりあえずボールを落としてみましょう。</p>
<div class="cell" data-tags="[]" data-execution_count="46">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>circles <span class="op">=</span> Circle(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    mass<span class="op">=</span>jnp.ones(<span class="dv">3</span>),</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    radius<span class="op">=</span>jnp.ones(<span class="dv">3</span>),</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    moment<span class="op">=</span>jnp.ones(<span class="dv">3</span>) <span class="op">*</span> <span class="fl">0.5</span>,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    elasticity<span class="op">=</span>jnp.ones(<span class="dv">3</span>),</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    friction<span class="op">=</span>jnp.ones(<span class="dv">3</span>),</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    rgba<span class="op">=</span>jnp.tile(jnp.array([<span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">1.0</span>]), (<span class="dv">3</span>, <span class="dv">1</span>)),</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>space <span class="op">=</span> Space(gravity<span class="op">=</span>jnp.array([<span class="fl">0.0</span>, <span class="op">-</span><span class="fl">9.8</span>]), circle<span class="op">=</span>circles)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> Position(</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    angle<span class="op">=</span>jnp.array([<span class="op">-</span><span class="dv">2</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>]),</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    xy<span class="op">=</span>jnp.array([[<span class="op">-</span><span class="dv">3</span>, <span class="fl">4.0</span>], [<span class="fl">0.0</span>, <span class="fl">2.0</span>], [<span class="fl">3.0</span>, <span class="dv">3</span>]]),</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>v <span class="op">=</span> Velocity.zeros(<span class="dv">3</span>)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> Force.zeros(<span class="dv">3</span>)</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> State(p<span class="op">=</span>p, v<span class="op">=</span>v, f<span class="op">=</span>f, is_active<span class="op">=</span>jnp.ones(<span class="dv">3</span>, dtype<span class="op">=</span><span class="bu">bool</span>))</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>positions <span class="op">=</span> [state.p]</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">20</span>):</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    state <span class="op">=</span> update_velocity(space, circles, state)</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    state <span class="op">=</span> update_position(space, state)</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    positions.append(state.p)</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>ax.set_aspect(<span class="st">"equal"</span>, adjustable<span class="op">=</span><span class="st">"box"</span>)</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>ax.set_xlim((<span class="op">-</span><span class="dv">5</span>, <span class="dv">5</span>))</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>ax.set_ylim((<span class="op">-</span><span class="dv">5</span>, <span class="dv">5</span>))</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>visualize_balls(ax, space.circle, positions)</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>fig</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="46">
<p><img src="fast_2d_physics_in_jax_files/figure-html/cell-5-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>できたっぽいですね。</p>
<section id="衝突判定を行う" class="level2">
<h2 class="anchored" data-anchor-id="衝突判定を行う">衝突判定を行う</h2>
<p>次に衝突判定を実装してみましょう。円と円しかないので判定自体は簡単ですが、後で衝突後の物理状態を求めるために計算するときのため、衝突した場所やそれによって発生したインパルスといった情報を保存しておく必要があります。 また、衝突判定を行う際、全てのペアについて衝突を検出するコードをナイーブに書くと、以下のようになります。</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(N):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(i <span class="op">+</span> <span class="dv">1</span>, N):</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>        check_contact(i, j)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>ですが、衝突検出は各ペアについて独立に行えるので、<code>jax.vmap</code>を使って並列化したいところです。そこで、このループを手動でアンロールし、あらかじめペアを生成してから<code>vmap</code>で並列化した衝突検出関数を呼ぶようにしました。以下のコード中の<code>generate_self_pairs</code>が全ペアを生成する関数になります。</p>
<div class="cell" data-tags="[]" data-execution_count="47">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Any, Callable</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>Axis <span class="op">=</span> Sequence[<span class="bu">int</span>] <span class="op">|</span> <span class="bu">int</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> safe_norm(x: jax.Array, axis: Axis <span class="op">|</span> <span class="va">None</span> <span class="op">=</span> <span class="va">None</span>) <span class="op">-&gt;</span> jax.Array:</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    is_zero <span class="op">=</span> jnp.allclose(x, <span class="fl">0.0</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> jnp.where(is_zero, jnp.ones_like(x), x)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> jnp.linalg.norm(x, axis<span class="op">=</span>axis)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> jnp.where(is_zero, <span class="fl">0.0</span>, n)  <span class="co"># pyright: ignore</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> normalize(x: jax.Array, axis: Axis <span class="op">|</span> <span class="va">None</span> <span class="op">=</span> <span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">tuple</span>[jax.Array, jax.Array]:</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    norm <span class="op">=</span> safe_norm(x, axis<span class="op">=</span>axis)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> x <span class="op">/</span> (norm <span class="op">+</span> <span class="fl">1e-6</span> <span class="op">*</span> (norm <span class="op">==</span> <span class="fl">0.0</span>))</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> n, norm</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> tree_map2(</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    f: Callable[..., Any],</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    tree: Any,</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>rest: Any,</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    is_leaf: Callable[[Any], <span class="bu">bool</span>] <span class="op">|</span> <span class="va">None</span> <span class="op">=</span> <span class="va">None</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> <span class="bu">tuple</span>[Any, Any]:</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Same as tree_map, but returns a tuple"""</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    leaves, treedef <span class="op">=</span> jax.tree_util.tree_flatten(tree, is_leaf)</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    all_leaves <span class="op">=</span> [leaves] <span class="op">+</span> [treedef.flatten_up_to(r) <span class="cf">for</span> r <span class="kw">in</span> rest]</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> [f(<span class="op">*</span>xs) <span class="cf">for</span> xs <span class="kw">in</span> <span class="bu">zip</span>(<span class="op">*</span>all_leaves)]</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> treedef.unflatten([elem[<span class="dv">0</span>] <span class="cf">for</span> elem <span class="kw">in</span> result])</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> treedef.unflatten([elem[<span class="dv">1</span>] <span class="cf">for</span> elem <span class="kw">in</span> result])</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a, b</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_self_pairs(x: jax.Array) <span class="op">-&gt;</span> <span class="bu">tuple</span>[jax.Array, jax.Array]:</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Returns two arrays that iterate over all combination of elements in x and y."""</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># x.shape[0] &gt; 1</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>    chex.assert_axis_dimension_gt(x, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> x.shape[<span class="dv">0</span>]</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># (a, a, a, b, b, c)</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>    outer_loop <span class="op">=</span> jnp.repeat(</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>        x,</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>        jnp.arange(n <span class="op">-</span> <span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>),</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>        axis<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>        total_repeat_length<span class="op">=</span>n <span class="op">*</span> (n <span class="op">-</span> <span class="dv">1</span>) <span class="op">//</span> <span class="dv">2</span>,</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># (b, c, d, c, d, d)</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>    inner_loop <span class="op">=</span> jnp.concatenate([x[i:] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(x))])</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> outer_loop, inner_loop</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a><span class="at">@chex.dataclass</span></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Contact(PyTreeOps):</span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>    pos: jax.Array</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>    normal: jax.Array</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>    penetration: jax.Array</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>    elasticity: jax.Array</span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>    friction: jax.Array</span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> contact_dim(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.pos.shape[<span class="dv">1</span>]</span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a><span class="at">@jax.vmap</span></span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _circle_to_circle_impl(</span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>    a: Circle,</span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>    b: Circle,</span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>    a_pos: Position,</span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>    b_pos: Position,</span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>    isactive: jax.Array,</span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> Contact:</span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a>    a2b_normal, dist <span class="op">=</span> normalize(b_pos.xy <span class="op">-</span> a_pos.xy)</span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a>    penetration <span class="op">=</span> a.radius <span class="op">+</span> b.radius <span class="op">-</span> dist</span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a>    a_contact <span class="op">=</span> a_pos.xy <span class="op">+</span> a2b_normal <span class="op">*</span> a.radius</span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a>    b_contact <span class="op">=</span> b_pos.xy <span class="op">-</span> a2b_normal <span class="op">*</span> b.radius</span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a>    pos <span class="op">=</span> (a_contact <span class="op">+</span> b_contact) <span class="op">*</span> <span class="fl">0.5</span></span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter penetration</span></span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a>    penetration <span class="op">=</span> jnp.where(isactive, penetration, jnp.ones_like(penetration) <span class="op">*</span> <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Contact(</span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a>        pos<span class="op">=</span>pos,</span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a>        normal<span class="op">=</span>a2b_normal,</span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a>        penetration<span class="op">=</span>penetration,</span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a>        elasticity<span class="op">=</span>(a.elasticity <span class="op">+</span> b.elasticity) <span class="op">*</span> <span class="fl">0.5</span>,</span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a>        friction<span class="op">=</span>(a.friction <span class="op">+</span> b.friction) <span class="op">*</span> <span class="fl">0.5</span>,</span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> check_circle_to_circle(</span>
<span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a>    space: Space,</span>
<span id="cb6-87"><a href="#cb6-87" aria-hidden="true" tabindex="-1"></a>    position: Position,</span>
<span id="cb6-88"><a href="#cb6-88" aria-hidden="true" tabindex="-1"></a>    is_active: jax.Array,</span>
<span id="cb6-89"><a href="#cb6-89" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> <span class="bu">tuple</span>[Contact, Circle, Circle]:</span>
<span id="cb6-90"><a href="#cb6-90" aria-hidden="true" tabindex="-1"></a>    circle1, circle2 <span class="op">=</span> tree_map2(generate_self_pairs, space.circle)</span>
<span id="cb6-91"><a href="#cb6-91" aria-hidden="true" tabindex="-1"></a>    pos1, pos2 <span class="op">=</span> tree_map2(generate_self_pairs, position)</span>
<span id="cb6-92"><a href="#cb6-92" aria-hidden="true" tabindex="-1"></a>    is_active <span class="op">=</span> jnp.logical_and(<span class="op">*</span>generate_self_pairs(is_active))</span>
<span id="cb6-93"><a href="#cb6-93" aria-hidden="true" tabindex="-1"></a>    contacts <span class="op">=</span> _circle_to_circle_impl(circle1, circle2, pos1, pos2, is_active)</span>
<span id="cb6-94"><a href="#cb6-94" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> contacts, circle1, circle2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-tags="[]" data-execution_count="48">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.patches <span class="im">import</span> Arrow</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>N <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>palette <span class="op">=</span> sns.color_palette(<span class="st">"husl"</span>, N)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>circles <span class="op">=</span> Circle(</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    mass<span class="op">=</span>jnp.ones(N),</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    radius<span class="op">=</span>jnp.ones(N),</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    moment<span class="op">=</span>jnp.ones(N) <span class="op">*</span> <span class="fl">0.5</span>,</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    elasticity<span class="op">=</span>jnp.ones(N) <span class="op">*</span> <span class="fl">0.5</span>,</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    friction<span class="op">=</span>jnp.ones(N) <span class="op">*</span> <span class="fl">0.2</span>,</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    rgba<span class="op">=</span>jnp.array([p <span class="op">+</span> (<span class="fl">1.0</span>,) <span class="cf">for</span> p <span class="kw">in</span> palette]),</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>space <span class="op">=</span> Space(gravity<span class="op">=</span>jnp.array([<span class="fl">0.0</span>, <span class="op">-</span><span class="fl">9.8</span>]), circle<span class="op">=</span>circles)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> Position(</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    angle<span class="op">=</span>jnp.zeros(N),</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    xy<span class="op">=</span>jnp.array([[<span class="op">-</span><span class="dv">3</span>, <span class="fl">4.0</span>], [<span class="fl">0.0</span>, <span class="fl">2.0</span>], [<span class="fl">5.0</span>, <span class="dv">3</span>], [<span class="op">-</span><span class="dv">3</span>, <span class="dv">1</span>], [<span class="dv">2</span>, <span class="dv">0</span>]]),</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>v_xy <span class="op">=</span> jnp.concatenate((jnp.zeros((N <span class="op">-</span> <span class="dv">2</span>, <span class="dv">2</span>)), jnp.array([[<span class="dv">0</span>, <span class="fl">10.0</span>], [<span class="op">-</span><span class="fl">2.0</span>, <span class="fl">8.0</span>]])))</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>v <span class="op">=</span> Velocity(angle<span class="op">=</span>jnp.zeros(N), xy<span class="op">=</span>v_xy)</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> Force(angle<span class="op">=</span>jnp.zeros(N), xy<span class="op">=</span>jnp.zeros((N, <span class="dv">2</span>)))</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> State(p<span class="op">=</span>p, v<span class="op">=</span>v, f<span class="op">=</span>f, is_active<span class="op">=</span>jnp.ones(N, dtype<span class="op">=</span><span class="bu">bool</span>))</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>positions <span class="op">=</span> [state.p]</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>contact_list <span class="op">=</span> []</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>):</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    state <span class="op">=</span> update_velocity(space, circles, state)</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    state <span class="op">=</span> update_position(space, state)</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    positions.append(state.p)</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    contacts, _, _ <span class="op">=</span> check_circle_to_circle(space, state.p, state.is_active)</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>    total_index <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(N):</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> k <span class="kw">in</span> <span class="bu">range</span>(j <span class="op">+</span> <span class="dv">1</span>, N):</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> contacts.penetration[total_index] <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>                contact_list.append(contacts.get_slice(total_index))</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>            total_index <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>ax.set_aspect(<span class="st">"equal"</span>, adjustable<span class="op">=</span><span class="st">"box"</span>)</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>ax.set_xlim((<span class="op">-</span><span class="dv">5</span>, <span class="dv">5</span>))</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>ax.set_ylim((<span class="op">-</span><span class="dv">5</span>, <span class="dv">5</span>))</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>visualize_balls(ax, space.circle, positions)</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> contact <span class="kw">in</span> contact_list:</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>    arrow <span class="op">=</span> Arrow(<span class="op">*</span>contact.pos, <span class="op">*</span>contact.normal, width<span class="op">=</span><span class="fl">0.2</span>, color<span class="op">=</span><span class="st">"r"</span>)</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>    ax.add_patch(arrow)</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>fig</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="48">
<p><img src="fast_2d_physics_in_jax_files/figure-html/cell-7-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>衝突後の処理を実装していないので物体がすりぬけていますが、衝突自体はきちんと検出されているようです。</p>
</section>
<section id="衝突した後どうすればいいの" class="level2">
<h2 class="anchored" data-anchor-id="衝突した後どうすればいいの">衝突した後どうすればいいの</h2>
<p>衝突を検出した後は、物体が重ならないように衝突時に発生したインパルスに関する制約つき方程式を解く必要があります。そのために色々な方法があるのですが、今回は<a href="https://github.com/slembcke/Chipmunk2D">Chipmunk</a>など2次元物理エンジンでよく使われている<a href="https://box2d.org/files/ErinCatto_SequentialImpulses_GDC2006.pdf">Sequential Impulse</a>と呼ばれる方法を使ってみます。なお、この資料は<a href="https://box2d.org">Box2D</a>のWebページで公開されているものです。</p>
<p>では、Sequential Impulseではどのようにして衝突を解決するのでしょうか。まず、物体の衝突時にインパルスが発生するという衝突モデルを仮定し、発生したインパルスを<span class="math inline">\(\mathbf{p}\)</span>とおきます。面倒なので角速度は一切考えないことにします。このとき、物体1の速度を<span class="math inline">\(\mathbf{v}_1\)</span>、質量を<span class="math inline">\(m_1\)</span>、物体2の速度を<span class="math inline">\(\mathbf{v}_2\)</span>、質量を<span class="math inline">\(m_2\)</span>とおくと、インパルスが発生した後の速度は <span class="math display">\[
\begin{align*}
\mathbf{v}_1 = \mathbf{v}_1^{\mathrm{old}} - \mathbf{p} / m_1 \\
\mathbf{v}_2 = \mathbf{v}_2^{\mathrm{old}} + \mathbf{p} / m_2
\end{align*}
\]</span> となります。このとき、<span class="math inline">\(\mathbf{p}\)</span>の方向は衝突の法線ベクトル<span class="math inline">\(\mathbf{n}\)</span>なので<span class="math inline">\(\mathbf{p} = p\mathbf{n}\)</span>と表せます。よって、結局<span class="math inline">\(p\)</span>を求めればいいです。衝突した点における相対速度を<span class="math inline">\(\Delta \mathbf{v} = \mathbf{v}_2 - \mathbf{v}_1\)</span>とおきます。このとき、<span class="math inline">\(\Delta \mathbf{v} \cdot n = 0\)</span>なので、上の2式と合わせて、<span class="math inline">\(p = \frac{-\Delta \mathbf{v}^{\mathrm{old}}\cdot \mathbf{n}}{\frac{1}{m_1} + \frac{1}{m_2}}\)</span>となります。角速度や摩擦を考慮するともう少しややこしくなりますが、基本はこんな感じです。</p>
<p>こうして計算したインパルスを全ての衝突に対して適用し、インパルスが小さくなるまで繰り返します。しかし、この手法は物体のめりこみを考慮していないので、これだけだと物体がめりこんだままになってしまうことがあります。 めり込みを減らすための手法はいくつかありますが、主に</p>
<ol type="1">
<li>どのくらいめり込んでいるかに応じてバイアス速度<span class="math inline">\(v_\mathrm{bias} = \frac{\beta}{\Delta t}\max(0, \delta - \delta_\mathrm{slop})\)</span>(<span class="math inline">\(\delta\)</span>はめりこみの長さ、<span class="math inline">\(\delta_\mathrm{slop}\)</span>は許容されるめりこみの長さ)を加え<span class="math inline">\(p = \frac{-\Delta \mathbf{v}^{\mathrm{old}}\cdot \mathbf{n} + v_\mathrm{bias}}{\frac{1}{m_1} + \frac{1}{m_2}}\)</span>とする (Baumegarte)</li>
<li>速度を更新した後にもう一回Positionに関する制約を解いて擬似的な速度を加える (Nonlinear Gauss Seidel, NGS)</li>
</ol>
<p>という2種類の手法があります。先程紹介したBox2Dの資料やChipmunk2Dでは1が、現在のBox2Dでは2が使われています。詳しくは<a href="https://github.com/erincatto/box2c/blob/a0a9c6e72c9f2174fdf6582c5d4ba60f5343b2ba/src/island.c#L27">Box2D 3.0のコメント</a>を参照してください。 今回は若干高速な1の手法を実装しようかと思ったのですが、この方法だと2つの物体が同じ方向に進んでいる時はめりこみを解消できないので、結局2の手法を実装しました。具体的にソルバの実装としては、</p>
<ol type="1">
<li>衝突により発生するインパルスに関する制約を解く</li>
<li>弾性により発生するインパルスを加える</li>
<li>位置に関する制約を解く</li>
</ol>
<p>という3つのステップに分けて実装すればいいです。</p>
<p>また、さっき並列化のため手動で全ペアに対するループをアンロールしましたが、Sequential Impulseの実装でもこれが使えます。ただし、インパルスを加えた後の速度の更新は、<code>v_update[i][j]</code>に<code>i</code>番目の物体と<code>j</code>番目の物体の衝突により生じる<code>i</code>番目の物体の速度変化が入っているとして、</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(N):</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(i <span class="op">+</span> <span class="dv">1</span>, N):</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>        obj[i].velocity <span class="op">+=</span> v_update[i][j]</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>        obj[j].velocity <span class="op">+=</span> v_update[j][i]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>のように各衝突により生じた速度変化を物体にフィードバックする必要があります。これもいちいちループで書くと遅くなってしまうのですが、さっきの<code>generate_self_pairs</code>で<span class="math inline">\(0, 1, 2, ..., N - 1\)</span>のペアを生成しておいてインデックスにするとループなしで書けます。細かく言うと、<code>generate_self_pairs</code>ではループが使われているのですが、<code>jax.jit</code>でコンパイルした時に計算結果がキャッシュされるはずなので気にしなくてもいいです。</p>
<p>というわけで実装してみましょう。実装は基本的に<a href="https://github.com/erincatto/box2d-lite">Box2d-Lite</a>と開発中の最新版である<a href="https://github.com/erincatto/box2c">Box2D 3.0</a>を参考にしました。また、Box2D作者のErin Catto氏による<a href="https://box2d.org/files/ErinCatto_UnderstandingConstraints_GDC2014.pdf">講演</a>の内容を<a href="https://github.com/eonarheim/iterative-constraint-solver">Typescriptで実装したリポジトリ</a>があったのでこれも参考にしました。</p>
<div class="cell" data-tags="[]" data-execution_count="49">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> functools</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="at">@chex.dataclass</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ContactHelper:</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    tangent: jax.Array</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    mass_normal: jax.Array</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    mass_tangent: jax.Array</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    v_bias: jax.Array</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    bounce: jax.Array</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    r1: jax.Array</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    r2: jax.Array</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    inv_mass1: jax.Array</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    inv_mass2: jax.Array</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    inv_moment1: jax.Array</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    inv_moment2: jax.Array</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    local_anchor1: jax.Array</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    local_anchor2: jax.Array</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    allow_bounce: jax.Array</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="at">@chex.dataclass</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> VelocitySolver:</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    v1: Velocity</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    v2: Velocity</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>    pn: jax.Array</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>    pt: jax.Array</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>    contact: jax.Array</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> update(<span class="va">self</span>, new_contact: jax.Array) <span class="op">-&gt;</span> Self:</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>        continuing_contact <span class="op">=</span> jnp.logical_and(<span class="va">self</span>.contact, new_contact)</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>        pn <span class="op">=</span> jnp.where(continuing_contact, <span class="va">self</span>.pn, jnp.zeros_like(<span class="va">self</span>.pn))</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>        pt <span class="op">=</span> jnp.where(continuing_contact, <span class="va">self</span>.pt, jnp.zeros_like(<span class="va">self</span>.pt))</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.replace(pn<span class="op">=</span>pn, pt<span class="op">=</span>pt, contact<span class="op">=</span>new_contact)</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> init_solver(n: <span class="bu">int</span>) <span class="op">-&gt;</span> VelocitySolver:</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> VelocitySolver(</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>        v1<span class="op">=</span>Velocity.zeros(n),</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>        v2<span class="op">=</span>Velocity.zeros(n),</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>        pn<span class="op">=</span>jnp.zeros(n),</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>        pt<span class="op">=</span>jnp.zeros(n),</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>        contact<span class="op">=</span>jnp.zeros(n, dtype<span class="op">=</span><span class="bu">bool</span>),</span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _pv_gather(</span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>    p1: _PositionLike,</span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>    p2: _PositionLike,</span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>    orig: _PositionLike,</span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> _PositionLike:</span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>    indices <span class="op">=</span> jnp.arange(<span class="bu">len</span>(orig.angle))</span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>    outer, inner <span class="op">=</span> generate_self_pairs(indices)</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>    p1_xy <span class="op">=</span> jnp.zeros_like(orig.xy).at[outer].add(p1.xy)</span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>    p1_angle <span class="op">=</span> jnp.zeros_like(orig.angle).at[outer].add(p1.angle)</span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>    p2_xy <span class="op">=</span> jnp.zeros_like(orig.xy).at[inner].add(p2.xy)</span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>    p2_angle <span class="op">=</span> jnp.zeros_like(orig.angle).at[inner].add(p2.angle)</span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> p1.__class__(xy<span class="op">=</span>p1_xy <span class="op">+</span> p2_xy, angle<span class="op">=</span>p1_angle <span class="op">+</span> p2_angle)</span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _vmap_dot(xy1: jax.Array, xy2: jax.Array) <span class="op">-&gt;</span> jax.Array:</span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Dot product between nested vectors"""</span></span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>    chex.assert_equal_shape((xy1, xy2))</span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>    orig_shape <span class="op">=</span> xy1.shape</span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> xy1.reshape(<span class="op">-</span><span class="dv">1</span>, orig_shape[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> xy2.reshape(<span class="op">-</span><span class="dv">1</span>, orig_shape[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> jax.vmap(jnp.dot, in_axes<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">0</span>))(a, b).reshape(<span class="op">*</span>orig_shape[:<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _sv_cross(s: jax.Array, v: jax.Array) <span class="op">-&gt;</span> jax.Array:</span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Cross product with scalar and vector"""</span></span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a>    x, y <span class="op">=</span> _get_xy(v)</span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> jnp.stack((y <span class="op">*</span> <span class="op">-</span>s, x <span class="op">*</span> s), axis<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _dv2from1(v1: Velocity, r1: jax.Array, v2: Velocity, r2: jax.Array) <span class="op">-&gt;</span> jax.Array:</span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Compute relative veclotiy from v2/r2 to v1/r1"""</span></span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a>    rel_v1 <span class="op">=</span> v1.xy <span class="op">+</span> _sv_cross(v1.angle, r1)</span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a>    rel_v2 <span class="op">=</span> v2.xy <span class="op">+</span> _sv_cross(v2.angle, r2)</span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> rel_v2 <span class="op">-</span> rel_v1</span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _effective_mass(</span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a>    inv_mass: jax.Array,</span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a>    inv_moment: jax.Array,</span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a>    r: jax.Array,</span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a>    n: jax.Array,</span>
<span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> jax.Array:</span>
<span id="cb9-89"><a href="#cb9-89" aria-hidden="true" tabindex="-1"></a>    rn2 <span class="op">=</span> jnp.cross(r, n) <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb9-90"><a href="#cb9-90" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> inv_mass <span class="op">+</span> inv_moment <span class="op">*</span> rn2</span>
<span id="cb9-91"><a href="#cb9-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-92"><a href="#cb9-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-93"><a href="#cb9-93" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> init_contact_helper(</span>
<span id="cb9-94"><a href="#cb9-94" aria-hidden="true" tabindex="-1"></a>    space: Space,</span>
<span id="cb9-95"><a href="#cb9-95" aria-hidden="true" tabindex="-1"></a>    contact: Contact,</span>
<span id="cb9-96"><a href="#cb9-96" aria-hidden="true" tabindex="-1"></a>    a: Shape,</span>
<span id="cb9-97"><a href="#cb9-97" aria-hidden="true" tabindex="-1"></a>    b: Shape,</span>
<span id="cb9-98"><a href="#cb9-98" aria-hidden="true" tabindex="-1"></a>    p1: Position,</span>
<span id="cb9-99"><a href="#cb9-99" aria-hidden="true" tabindex="-1"></a>    p2: Position,</span>
<span id="cb9-100"><a href="#cb9-100" aria-hidden="true" tabindex="-1"></a>    v1: Velocity,</span>
<span id="cb9-101"><a href="#cb9-101" aria-hidden="true" tabindex="-1"></a>    v2: Velocity,</span>
<span id="cb9-102"><a href="#cb9-102" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> ContactHelper:</span>
<span id="cb9-103"><a href="#cb9-103" aria-hidden="true" tabindex="-1"></a>    r1 <span class="op">=</span> contact.pos <span class="op">-</span> p1.xy</span>
<span id="cb9-104"><a href="#cb9-104" aria-hidden="true" tabindex="-1"></a>    r2 <span class="op">=</span> contact.pos <span class="op">-</span> p2.xy</span>
<span id="cb9-105"><a href="#cb9-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-106"><a href="#cb9-106" aria-hidden="true" tabindex="-1"></a>    inv_mass1, inv_mass2 <span class="op">=</span> a.inv_mass(), b.inv_mass()</span>
<span id="cb9-107"><a href="#cb9-107" aria-hidden="true" tabindex="-1"></a>    inv_moment1, inv_moment2 <span class="op">=</span> a.inv_moment(), b.inv_moment()</span>
<span id="cb9-108"><a href="#cb9-108" aria-hidden="true" tabindex="-1"></a>    kn1 <span class="op">=</span> _effective_mass(inv_mass1, inv_moment1, r1, contact.normal)</span>
<span id="cb9-109"><a href="#cb9-109" aria-hidden="true" tabindex="-1"></a>    kn2 <span class="op">=</span> _effective_mass(inv_mass2, inv_moment2, r2, contact.normal)</span>
<span id="cb9-110"><a href="#cb9-110" aria-hidden="true" tabindex="-1"></a>    nx, ny <span class="op">=</span> _get_xy(contact.normal)</span>
<span id="cb9-111"><a href="#cb9-111" aria-hidden="true" tabindex="-1"></a>    tangent <span class="op">=</span> jnp.stack((<span class="op">-</span>ny, nx), axis<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb9-112"><a href="#cb9-112" aria-hidden="true" tabindex="-1"></a>    kt1 <span class="op">=</span> _effective_mass(inv_mass1, inv_moment1, r1, tangent)</span>
<span id="cb9-113"><a href="#cb9-113" aria-hidden="true" tabindex="-1"></a>    kt2 <span class="op">=</span> _effective_mass(inv_mass2, inv_moment2, r2, tangent)</span>
<span id="cb9-114"><a href="#cb9-114" aria-hidden="true" tabindex="-1"></a>    clipped_p <span class="op">=</span> jnp.clip(space.allowed_penetration <span class="op">-</span> contact.penetration, a_max<span class="op">=</span><span class="fl">0.0</span>)</span>
<span id="cb9-115"><a href="#cb9-115" aria-hidden="true" tabindex="-1"></a>    v_bias <span class="op">=</span> <span class="op">-</span>space.bias_factor <span class="op">/</span> space.dt <span class="op">*</span> clipped_p</span>
<span id="cb9-116"><a href="#cb9-116" aria-hidden="true" tabindex="-1"></a>    <span class="co"># k_normal, k_tangent, and v_bias should have (N(N-1)/2, N_contacts) shape</span></span>
<span id="cb9-117"><a href="#cb9-117" aria-hidden="true" tabindex="-1"></a>    chex.assert_equal_shape((contact.friction, kn1, kn2, kt1, kt2, v_bias))</span>
<span id="cb9-118"><a href="#cb9-118" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute elasiticity * relative_vel</span></span>
<span id="cb9-119"><a href="#cb9-119" aria-hidden="true" tabindex="-1"></a>    dv <span class="op">=</span> _dv2from1(v1, r1, v2, r2)</span>
<span id="cb9-120"><a href="#cb9-120" aria-hidden="true" tabindex="-1"></a>    vn <span class="op">=</span> _vmap_dot(dv, contact.normal)</span>
<span id="cb9-121"><a href="#cb9-121" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ContactHelper(</span>
<span id="cb9-122"><a href="#cb9-122" aria-hidden="true" tabindex="-1"></a>        tangent<span class="op">=</span>tangent,</span>
<span id="cb9-123"><a href="#cb9-123" aria-hidden="true" tabindex="-1"></a>        mass_normal<span class="op">=</span><span class="dv">1</span> <span class="op">/</span> (kn1 <span class="op">+</span> kn2),</span>
<span id="cb9-124"><a href="#cb9-124" aria-hidden="true" tabindex="-1"></a>        mass_tangent<span class="op">=</span><span class="dv">1</span> <span class="op">/</span> (kt1 <span class="op">+</span> kt2),</span>
<span id="cb9-125"><a href="#cb9-125" aria-hidden="true" tabindex="-1"></a>        v_bias<span class="op">=</span>v_bias,</span>
<span id="cb9-126"><a href="#cb9-126" aria-hidden="true" tabindex="-1"></a>        bounce<span class="op">=</span>vn <span class="op">*</span> contact.elasticity,</span>
<span id="cb9-127"><a href="#cb9-127" aria-hidden="true" tabindex="-1"></a>        r1<span class="op">=</span>r1,</span>
<span id="cb9-128"><a href="#cb9-128" aria-hidden="true" tabindex="-1"></a>        r2<span class="op">=</span>r2,</span>
<span id="cb9-129"><a href="#cb9-129" aria-hidden="true" tabindex="-1"></a>        inv_mass1<span class="op">=</span>inv_mass1,</span>
<span id="cb9-130"><a href="#cb9-130" aria-hidden="true" tabindex="-1"></a>        inv_mass2<span class="op">=</span>inv_mass2,</span>
<span id="cb9-131"><a href="#cb9-131" aria-hidden="true" tabindex="-1"></a>        inv_moment1<span class="op">=</span>inv_moment1,</span>
<span id="cb9-132"><a href="#cb9-132" aria-hidden="true" tabindex="-1"></a>        inv_moment2<span class="op">=</span>inv_moment2,</span>
<span id="cb9-133"><a href="#cb9-133" aria-hidden="true" tabindex="-1"></a>        local_anchor1<span class="op">=</span>p1.inv_rotate(r1),</span>
<span id="cb9-134"><a href="#cb9-134" aria-hidden="true" tabindex="-1"></a>        local_anchor2<span class="op">=</span>p2.inv_rotate(r2),</span>
<span id="cb9-135"><a href="#cb9-135" aria-hidden="true" tabindex="-1"></a>        allow_bounce<span class="op">=</span>vn <span class="op">&lt;=</span> <span class="op">-</span>space.bounce_threshold,</span>
<span id="cb9-136"><a href="#cb9-136" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-137"><a href="#cb9-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-138"><a href="#cb9-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-139"><a href="#cb9-139" aria-hidden="true" tabindex="-1"></a><span class="at">@jax.vmap</span></span>
<span id="cb9-140"><a href="#cb9-140" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> apply_initial_impulse(</span>
<span id="cb9-141"><a href="#cb9-141" aria-hidden="true" tabindex="-1"></a>    contact: Contact,</span>
<span id="cb9-142"><a href="#cb9-142" aria-hidden="true" tabindex="-1"></a>    helper: ContactHelper,</span>
<span id="cb9-143"><a href="#cb9-143" aria-hidden="true" tabindex="-1"></a>    solver: VelocitySolver,</span>
<span id="cb9-144"><a href="#cb9-144" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> VelocitySolver:</span>
<span id="cb9-145"><a href="#cb9-145" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Warm starting by applying initial impulse"""</span></span>
<span id="cb9-146"><a href="#cb9-146" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> helper.tangent <span class="op">*</span> solver.pt <span class="op">+</span> contact.normal <span class="op">*</span> solver.pn</span>
<span id="cb9-147"><a href="#cb9-147" aria-hidden="true" tabindex="-1"></a>    v1 <span class="op">=</span> solver.v1 <span class="op">-</span> Velocity(</span>
<span id="cb9-148"><a href="#cb9-148" aria-hidden="true" tabindex="-1"></a>        angle<span class="op">=</span>helper.inv_moment1 <span class="op">*</span> jnp.cross(helper.r1, p),</span>
<span id="cb9-149"><a href="#cb9-149" aria-hidden="true" tabindex="-1"></a>        xy<span class="op">=</span>p <span class="op">*</span> helper.inv_mass1,</span>
<span id="cb9-150"><a href="#cb9-150" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-151"><a href="#cb9-151" aria-hidden="true" tabindex="-1"></a>    v2 <span class="op">=</span> solver.v2 <span class="op">+</span> Velocity(</span>
<span id="cb9-152"><a href="#cb9-152" aria-hidden="true" tabindex="-1"></a>        angle<span class="op">=</span>helper.inv_moment2 <span class="op">*</span> jnp.cross(helper.r2, p),</span>
<span id="cb9-153"><a href="#cb9-153" aria-hidden="true" tabindex="-1"></a>        xy<span class="op">=</span>p <span class="op">*</span> helper.inv_mass2,</span>
<span id="cb9-154"><a href="#cb9-154" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-155"><a href="#cb9-155" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> solver.replace(v1<span class="op">=</span>v1, v2<span class="op">=</span>v2)</span>
<span id="cb9-156"><a href="#cb9-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-157"><a href="#cb9-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-158"><a href="#cb9-158" aria-hidden="true" tabindex="-1"></a><span class="at">@jax.vmap</span></span>
<span id="cb9-159"><a href="#cb9-159" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> apply_velocity_normal(</span>
<span id="cb9-160"><a href="#cb9-160" aria-hidden="true" tabindex="-1"></a>    contact: Contact,</span>
<span id="cb9-161"><a href="#cb9-161" aria-hidden="true" tabindex="-1"></a>    helper: ContactHelper,</span>
<span id="cb9-162"><a href="#cb9-162" aria-hidden="true" tabindex="-1"></a>    solver: VelocitySolver,</span>
<span id="cb9-163"><a href="#cb9-163" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> VelocitySolver:</span>
<span id="cb9-164"><a href="#cb9-164" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb9-165"><a href="#cb9-165" aria-hidden="true" tabindex="-1"></a><span class="co">    Apply velocity constraints to the solver.</span></span>
<span id="cb9-166"><a href="#cb9-166" aria-hidden="true" tabindex="-1"></a><span class="co">    Suppose that each shape has (N_contact, 1) or (N_contact, 2).</span></span>
<span id="cb9-167"><a href="#cb9-167" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb9-168"><a href="#cb9-168" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Relative veclocity (from shape2 to shape1)</span></span>
<span id="cb9-169"><a href="#cb9-169" aria-hidden="true" tabindex="-1"></a>    dv <span class="op">=</span> _dv2from1(solver.v1, helper.r1, solver.v2, helper.r2)</span>
<span id="cb9-170"><a href="#cb9-170" aria-hidden="true" tabindex="-1"></a>    vt <span class="op">=</span> jnp.dot(dv, helper.tangent)</span>
<span id="cb9-171"><a href="#cb9-171" aria-hidden="true" tabindex="-1"></a>    dpt <span class="op">=</span> <span class="op">-</span>helper.mass_tangent <span class="op">*</span> vt</span>
<span id="cb9-172"><a href="#cb9-172" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Clamp friction impulse</span></span>
<span id="cb9-173"><a href="#cb9-173" aria-hidden="true" tabindex="-1"></a>    max_pt <span class="op">=</span> contact.friction <span class="op">*</span> solver.pn</span>
<span id="cb9-174"><a href="#cb9-174" aria-hidden="true" tabindex="-1"></a>    pt <span class="op">=</span> jnp.clip(solver.pt <span class="op">+</span> dpt, a_min<span class="op">=-</span>max_pt, a_max<span class="op">=</span>max_pt)</span>
<span id="cb9-175"><a href="#cb9-175" aria-hidden="true" tabindex="-1"></a>    dpt_clamped <span class="op">=</span> helper.tangent <span class="op">*</span> (pt <span class="op">-</span> solver.pt)</span>
<span id="cb9-176"><a href="#cb9-176" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Velocity update by contact tangent</span></span>
<span id="cb9-177"><a href="#cb9-177" aria-hidden="true" tabindex="-1"></a>    dvt1 <span class="op">=</span> Velocity(</span>
<span id="cb9-178"><a href="#cb9-178" aria-hidden="true" tabindex="-1"></a>        angle<span class="op">=-</span>helper.inv_moment1 <span class="op">*</span> jnp.cross(helper.r1, dpt_clamped),</span>
<span id="cb9-179"><a href="#cb9-179" aria-hidden="true" tabindex="-1"></a>        xy<span class="op">=-</span>dpt_clamped <span class="op">*</span> helper.inv_mass1,</span>
<span id="cb9-180"><a href="#cb9-180" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-181"><a href="#cb9-181" aria-hidden="true" tabindex="-1"></a>    dvt2 <span class="op">=</span> Velocity(</span>
<span id="cb9-182"><a href="#cb9-182" aria-hidden="true" tabindex="-1"></a>        angle<span class="op">=</span>helper.inv_moment2 <span class="op">*</span> jnp.cross(helper.r2, dpt_clamped),</span>
<span id="cb9-183"><a href="#cb9-183" aria-hidden="true" tabindex="-1"></a>        xy<span class="op">=</span>dpt_clamped <span class="op">*</span> helper.inv_mass2,</span>
<span id="cb9-184"><a href="#cb9-184" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-185"><a href="#cb9-185" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute Relative velocity again</span></span>
<span id="cb9-186"><a href="#cb9-186" aria-hidden="true" tabindex="-1"></a>    dv <span class="op">=</span> _dv2from1(solver.v1 <span class="op">+</span> dvt1, helper.r1, solver.v2 <span class="op">+</span> dvt2, helper.r2)</span>
<span id="cb9-187"><a href="#cb9-187" aria-hidden="true" tabindex="-1"></a>    vn <span class="op">=</span> _vmap_dot(dv, contact.normal)</span>
<span id="cb9-188"><a href="#cb9-188" aria-hidden="true" tabindex="-1"></a>    dpn <span class="op">=</span> helper.mass_normal <span class="op">*</span> (<span class="op">-</span>vn <span class="op">+</span> helper.v_bias)</span>
<span id="cb9-189"><a href="#cb9-189" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accumulate and clamp impulse</span></span>
<span id="cb9-190"><a href="#cb9-190" aria-hidden="true" tabindex="-1"></a>    pn <span class="op">=</span> jnp.clip(solver.pn <span class="op">+</span> dpn, a_min<span class="op">=</span><span class="fl">0.0</span>)</span>
<span id="cb9-191"><a href="#cb9-191" aria-hidden="true" tabindex="-1"></a>    dpn_clamped <span class="op">=</span> contact.normal <span class="op">*</span> (pn <span class="op">-</span> solver.pn)</span>
<span id="cb9-192"><a href="#cb9-192" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Velocity update by contact normal</span></span>
<span id="cb9-193"><a href="#cb9-193" aria-hidden="true" tabindex="-1"></a>    dvn1 <span class="op">=</span> Velocity(</span>
<span id="cb9-194"><a href="#cb9-194" aria-hidden="true" tabindex="-1"></a>        angle<span class="op">=-</span>helper.inv_moment1 <span class="op">*</span> jnp.cross(helper.r1, dpn_clamped),</span>
<span id="cb9-195"><a href="#cb9-195" aria-hidden="true" tabindex="-1"></a>        xy<span class="op">=-</span>dpn_clamped <span class="op">*</span> helper.inv_mass1,</span>
<span id="cb9-196"><a href="#cb9-196" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-197"><a href="#cb9-197" aria-hidden="true" tabindex="-1"></a>    dvn2 <span class="op">=</span> Velocity(</span>
<span id="cb9-198"><a href="#cb9-198" aria-hidden="true" tabindex="-1"></a>        angle<span class="op">=</span>helper.inv_moment2 <span class="op">*</span> jnp.cross(helper.r2, dpn_clamped),</span>
<span id="cb9-199"><a href="#cb9-199" aria-hidden="true" tabindex="-1"></a>        xy<span class="op">=</span>dpn_clamped <span class="op">*</span> helper.inv_mass2,</span>
<span id="cb9-200"><a href="#cb9-200" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-201"><a href="#cb9-201" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter dv</span></span>
<span id="cb9-202"><a href="#cb9-202" aria-hidden="true" tabindex="-1"></a>    dv1, dv2 <span class="op">=</span> jax.tree_map(</span>
<span id="cb9-203"><a href="#cb9-203" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> x: jnp.where(solver.contact, x, jnp.zeros_like(x)),</span>
<span id="cb9-204"><a href="#cb9-204" aria-hidden="true" tabindex="-1"></a>        (dvn1 <span class="op">+</span> dvt1, dvn2 <span class="op">+</span> dvt2),</span>
<span id="cb9-205"><a href="#cb9-205" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-206"><a href="#cb9-206" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Summing up dv per each contact pair</span></span>
<span id="cb9-207"><a href="#cb9-207" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> VelocitySolver(</span>
<span id="cb9-208"><a href="#cb9-208" aria-hidden="true" tabindex="-1"></a>        v1<span class="op">=</span>dv1,</span>
<span id="cb9-209"><a href="#cb9-209" aria-hidden="true" tabindex="-1"></a>        v2<span class="op">=</span>dv2,</span>
<span id="cb9-210"><a href="#cb9-210" aria-hidden="true" tabindex="-1"></a>        pn<span class="op">=</span>pn,</span>
<span id="cb9-211"><a href="#cb9-211" aria-hidden="true" tabindex="-1"></a>        pt<span class="op">=</span>pt,</span>
<span id="cb9-212"><a href="#cb9-212" aria-hidden="true" tabindex="-1"></a>        contact<span class="op">=</span>solver.contact,</span>
<span id="cb9-213"><a href="#cb9-213" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-214"><a href="#cb9-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-215"><a href="#cb9-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-216"><a href="#cb9-216" aria-hidden="true" tabindex="-1"></a><span class="at">@jax.vmap</span></span>
<span id="cb9-217"><a href="#cb9-217" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> apply_bounce(</span>
<span id="cb9-218"><a href="#cb9-218" aria-hidden="true" tabindex="-1"></a>    contact: Contact,</span>
<span id="cb9-219"><a href="#cb9-219" aria-hidden="true" tabindex="-1"></a>    helper: ContactHelper,</span>
<span id="cb9-220"><a href="#cb9-220" aria-hidden="true" tabindex="-1"></a>    solver: VelocitySolver,</span>
<span id="cb9-221"><a href="#cb9-221" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> <span class="bu">tuple</span>[Velocity, Velocity]:</span>
<span id="cb9-222"><a href="#cb9-222" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb9-223"><a href="#cb9-223" aria-hidden="true" tabindex="-1"></a><span class="co">    Apply bounce (resititution).</span></span>
<span id="cb9-224"><a href="#cb9-224" aria-hidden="true" tabindex="-1"></a><span class="co">    Suppose that each shape has (N_contact, 1) or (N_contact, 2).</span></span>
<span id="cb9-225"><a href="#cb9-225" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb9-226"><a href="#cb9-226" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Relative veclocity (from shape2 to shape1)</span></span>
<span id="cb9-227"><a href="#cb9-227" aria-hidden="true" tabindex="-1"></a>    dv <span class="op">=</span> _dv2from1(solver.v1, helper.r1, solver.v2, helper.r2)</span>
<span id="cb9-228"><a href="#cb9-228" aria-hidden="true" tabindex="-1"></a>    vn <span class="op">=</span> jnp.dot(dv, contact.normal)</span>
<span id="cb9-229"><a href="#cb9-229" aria-hidden="true" tabindex="-1"></a>    pn <span class="op">=</span> <span class="op">-</span>helper.mass_normal <span class="op">*</span> (vn <span class="op">+</span> helper.bounce)</span>
<span id="cb9-230"><a href="#cb9-230" aria-hidden="true" tabindex="-1"></a>    dpn <span class="op">=</span> contact.normal <span class="op">*</span> pn</span>
<span id="cb9-231"><a href="#cb9-231" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Velocity update by contact normal</span></span>
<span id="cb9-232"><a href="#cb9-232" aria-hidden="true" tabindex="-1"></a>    dv1 <span class="op">=</span> Velocity(</span>
<span id="cb9-233"><a href="#cb9-233" aria-hidden="true" tabindex="-1"></a>        angle<span class="op">=-</span>helper.inv_moment1 <span class="op">*</span> jnp.cross(helper.r1, dpn),</span>
<span id="cb9-234"><a href="#cb9-234" aria-hidden="true" tabindex="-1"></a>        xy<span class="op">=-</span>dpn <span class="op">*</span> helper.inv_mass1,</span>
<span id="cb9-235"><a href="#cb9-235" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-236"><a href="#cb9-236" aria-hidden="true" tabindex="-1"></a>    dv2 <span class="op">=</span> Velocity(</span>
<span id="cb9-237"><a href="#cb9-237" aria-hidden="true" tabindex="-1"></a>        angle<span class="op">=</span>helper.inv_moment2 <span class="op">*</span> jnp.cross(helper.r2, dpn),</span>
<span id="cb9-238"><a href="#cb9-238" aria-hidden="true" tabindex="-1"></a>        xy<span class="op">=</span>dpn <span class="op">*</span> helper.inv_mass2,</span>
<span id="cb9-239"><a href="#cb9-239" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-240"><a href="#cb9-240" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter dv</span></span>
<span id="cb9-241"><a href="#cb9-241" aria-hidden="true" tabindex="-1"></a>    allow_bounce <span class="op">=</span> jnp.logical_and(solver.contact, helper.allow_bounce)</span>
<span id="cb9-242"><a href="#cb9-242" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> jax.tree_map(</span>
<span id="cb9-243"><a href="#cb9-243" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> x: jnp.where(allow_bounce, x, jnp.zeros_like(x)),</span>
<span id="cb9-244"><a href="#cb9-244" aria-hidden="true" tabindex="-1"></a>        (dv1, dv2),</span>
<span id="cb9-245"><a href="#cb9-245" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-246"><a href="#cb9-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-247"><a href="#cb9-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-248"><a href="#cb9-248" aria-hidden="true" tabindex="-1"></a><span class="at">@chex.dataclass</span></span>
<span id="cb9-249"><a href="#cb9-249" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> PositionSolver:</span>
<span id="cb9-250"><a href="#cb9-250" aria-hidden="true" tabindex="-1"></a>    p1: Position</span>
<span id="cb9-251"><a href="#cb9-251" aria-hidden="true" tabindex="-1"></a>    p2: Position</span>
<span id="cb9-252"><a href="#cb9-252" aria-hidden="true" tabindex="-1"></a>    contact: jax.Array</span>
<span id="cb9-253"><a href="#cb9-253" aria-hidden="true" tabindex="-1"></a>    min_separation: jax.Array</span>
<span id="cb9-254"><a href="#cb9-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-255"><a href="#cb9-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-256"><a href="#cb9-256" aria-hidden="true" tabindex="-1"></a><span class="at">@functools.partial</span>(jax.vmap, in_axes<span class="op">=</span>(<span class="va">None</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb9-257"><a href="#cb9-257" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> correct_position(</span>
<span id="cb9-258"><a href="#cb9-258" aria-hidden="true" tabindex="-1"></a>    bias_factor: <span class="bu">float</span> <span class="op">|</span> jax.Array,</span>
<span id="cb9-259"><a href="#cb9-259" aria-hidden="true" tabindex="-1"></a>    linear_slop: <span class="bu">float</span> <span class="op">|</span> jax.Array,</span>
<span id="cb9-260"><a href="#cb9-260" aria-hidden="true" tabindex="-1"></a>    max_linear_correction: <span class="bu">float</span> <span class="op">|</span> jax.Array,</span>
<span id="cb9-261"><a href="#cb9-261" aria-hidden="true" tabindex="-1"></a>    contact: Contact,</span>
<span id="cb9-262"><a href="#cb9-262" aria-hidden="true" tabindex="-1"></a>    helper: ContactHelper,</span>
<span id="cb9-263"><a href="#cb9-263" aria-hidden="true" tabindex="-1"></a>    solver: PositionSolver,</span>
<span id="cb9-264"><a href="#cb9-264" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> PositionSolver:</span>
<span id="cb9-265"><a href="#cb9-265" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb9-266"><a href="#cb9-266" aria-hidden="true" tabindex="-1"></a><span class="co">    Correct positions to remove penetration.</span></span>
<span id="cb9-267"><a href="#cb9-267" aria-hidden="true" tabindex="-1"></a><span class="co">    Suppose that each shape in contact and helper has (N_contact, 1) or (N_contact, 2).</span></span>
<span id="cb9-268"><a href="#cb9-268" aria-hidden="true" tabindex="-1"></a><span class="co">    p1 and p2 should have xy: (1, 2) angle (1, 1) shape</span></span>
<span id="cb9-269"><a href="#cb9-269" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb9-270"><a href="#cb9-270" aria-hidden="true" tabindex="-1"></a>    <span class="co"># (N_contact, 2)</span></span>
<span id="cb9-271"><a href="#cb9-271" aria-hidden="true" tabindex="-1"></a>    r1 <span class="op">=</span> solver.p1.rotate(helper.local_anchor1)</span>
<span id="cb9-272"><a href="#cb9-272" aria-hidden="true" tabindex="-1"></a>    r2 <span class="op">=</span> solver.p2.rotate(helper.local_anchor2)</span>
<span id="cb9-273"><a href="#cb9-273" aria-hidden="true" tabindex="-1"></a>    ga2_ga1 <span class="op">=</span> r2 <span class="op">-</span> r1 <span class="op">+</span> solver.p2.xy <span class="op">-</span> solver.p1.xy</span>
<span id="cb9-274"><a href="#cb9-274" aria-hidden="true" tabindex="-1"></a>    separation <span class="op">=</span> jnp.dot(ga2_ga1, contact.normal) <span class="op">-</span> contact.penetration</span>
<span id="cb9-275"><a href="#cb9-275" aria-hidden="true" tabindex="-1"></a>    c <span class="op">=</span> jnp.clip(</span>
<span id="cb9-276"><a href="#cb9-276" aria-hidden="true" tabindex="-1"></a>        bias_factor <span class="op">*</span> (separation <span class="op">+</span> linear_slop),</span>
<span id="cb9-277"><a href="#cb9-277" aria-hidden="true" tabindex="-1"></a>        a_min<span class="op">=-</span>max_linear_correction,</span>
<span id="cb9-278"><a href="#cb9-278" aria-hidden="true" tabindex="-1"></a>        a_max<span class="op">=</span><span class="fl">0.0</span>,</span>
<span id="cb9-279"><a href="#cb9-279" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-280"><a href="#cb9-280" aria-hidden="true" tabindex="-1"></a>    kn1 <span class="op">=</span> _effective_mass(helper.inv_mass1, helper.inv_moment1, r1, contact.normal)</span>
<span id="cb9-281"><a href="#cb9-281" aria-hidden="true" tabindex="-1"></a>    kn2 <span class="op">=</span> _effective_mass(helper.inv_mass2, helper.inv_moment2, r2, contact.normal)</span>
<span id="cb9-282"><a href="#cb9-282" aria-hidden="true" tabindex="-1"></a>    k_normal <span class="op">=</span> kn1 <span class="op">+</span> kn2</span>
<span id="cb9-283"><a href="#cb9-283" aria-hidden="true" tabindex="-1"></a>    impulse <span class="op">=</span> jnp.where(k_normal <span class="op">&gt;</span> <span class="fl">0.0</span>, <span class="op">-</span>c <span class="op">/</span> k_normal, jnp.zeros_like(c))</span>
<span id="cb9-284"><a href="#cb9-284" aria-hidden="true" tabindex="-1"></a>    pn <span class="op">=</span> impulse <span class="op">*</span> contact.normal</span>
<span id="cb9-285"><a href="#cb9-285" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> Position(</span>
<span id="cb9-286"><a href="#cb9-286" aria-hidden="true" tabindex="-1"></a>        angle<span class="op">=-</span>helper.inv_moment1 <span class="op">*</span> jnp.cross(r1, pn),</span>
<span id="cb9-287"><a href="#cb9-287" aria-hidden="true" tabindex="-1"></a>        xy<span class="op">=-</span>pn <span class="op">*</span> helper.inv_mass1,</span>
<span id="cb9-288"><a href="#cb9-288" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-289"><a href="#cb9-289" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> Position(</span>
<span id="cb9-290"><a href="#cb9-290" aria-hidden="true" tabindex="-1"></a>        angle<span class="op">=</span>helper.inv_moment2 <span class="op">*</span> jnp.cross(r2, pn),</span>
<span id="cb9-291"><a href="#cb9-291" aria-hidden="true" tabindex="-1"></a>        xy<span class="op">=</span>pn <span class="op">*</span> helper.inv_mass2,</span>
<span id="cb9-292"><a href="#cb9-292" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-293"><a href="#cb9-293" aria-hidden="true" tabindex="-1"></a>    min_sep <span class="op">=</span> jnp.fmin(solver.min_separation, separation)</span>
<span id="cb9-294"><a href="#cb9-294" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter separation</span></span>
<span id="cb9-295"><a href="#cb9-295" aria-hidden="true" tabindex="-1"></a>    p1, p2 <span class="op">=</span> jax.tree_map(</span>
<span id="cb9-296"><a href="#cb9-296" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> x: jnp.where(solver.contact, x, jnp.zeros_like(x)),</span>
<span id="cb9-297"><a href="#cb9-297" aria-hidden="true" tabindex="-1"></a>        (p1, p2),</span>
<span id="cb9-298"><a href="#cb9-298" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-299"><a href="#cb9-299" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> solver.replace(p1<span class="op">=</span>p1, p2<span class="op">=</span>p2, min_separation<span class="op">=</span>min_sep)</span>
<span id="cb9-300"><a href="#cb9-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-301"><a href="#cb9-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-302"><a href="#cb9-302" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fake_fori_loop(start, end, step, initial):</span>
<span id="cb9-303"><a href="#cb9-303" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""For debugging. Just replace jax.lax.fori_loop with this."""</span></span>
<span id="cb9-304"><a href="#cb9-304" aria-hidden="true" tabindex="-1"></a>    state <span class="op">=</span> initial</span>
<span id="cb9-305"><a href="#cb9-305" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(start, end):</span>
<span id="cb9-306"><a href="#cb9-306" aria-hidden="true" tabindex="-1"></a>        state <span class="op">=</span> step(i, state)</span>
<span id="cb9-307"><a href="#cb9-307" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> state</span>
<span id="cb9-308"><a href="#cb9-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-309"><a href="#cb9-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-310"><a href="#cb9-310" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> apply_seq_impulses(</span>
<span id="cb9-311"><a href="#cb9-311" aria-hidden="true" tabindex="-1"></a>    space: Space,</span>
<span id="cb9-312"><a href="#cb9-312" aria-hidden="true" tabindex="-1"></a>    solver: VelocitySolver,</span>
<span id="cb9-313"><a href="#cb9-313" aria-hidden="true" tabindex="-1"></a>    p: Position,</span>
<span id="cb9-314"><a href="#cb9-314" aria-hidden="true" tabindex="-1"></a>    v: Velocity,</span>
<span id="cb9-315"><a href="#cb9-315" aria-hidden="true" tabindex="-1"></a>    contact: Contact,</span>
<span id="cb9-316"><a href="#cb9-316" aria-hidden="true" tabindex="-1"></a>    a: Shape,</span>
<span id="cb9-317"><a href="#cb9-317" aria-hidden="true" tabindex="-1"></a>    b: Shape,</span>
<span id="cb9-318"><a href="#cb9-318" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> <span class="bu">tuple</span>[Velocity, Position, VelocitySolver]:</span>
<span id="cb9-319"><a href="#cb9-319" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Resolve collisions by Sequential Impulse method"""</span></span>
<span id="cb9-320"><a href="#cb9-320" aria-hidden="true" tabindex="-1"></a>    p1, p2 <span class="op">=</span> tree_map2(generate_self_pairs, p)</span>
<span id="cb9-321"><a href="#cb9-321" aria-hidden="true" tabindex="-1"></a>    v1, v2 <span class="op">=</span> tree_map2(generate_self_pairs, v)</span>
<span id="cb9-322"><a href="#cb9-322" aria-hidden="true" tabindex="-1"></a>    helper <span class="op">=</span> init_contact_helper(space, contact, a, b, p1, p2, v1, v2)</span>
<span id="cb9-323"><a href="#cb9-323" aria-hidden="true" tabindex="-1"></a>    solver <span class="op">=</span> apply_initial_impulse(</span>
<span id="cb9-324"><a href="#cb9-324" aria-hidden="true" tabindex="-1"></a>        contact,</span>
<span id="cb9-325"><a href="#cb9-325" aria-hidden="true" tabindex="-1"></a>        helper,</span>
<span id="cb9-326"><a href="#cb9-326" aria-hidden="true" tabindex="-1"></a>        solver.replace(v1<span class="op">=</span>v1, v2<span class="op">=</span>v2),</span>
<span id="cb9-327"><a href="#cb9-327" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-328"><a href="#cb9-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-329"><a href="#cb9-329" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> vstep(</span>
<span id="cb9-330"><a href="#cb9-330" aria-hidden="true" tabindex="-1"></a>        _n_iter: <span class="bu">int</span>,</span>
<span id="cb9-331"><a href="#cb9-331" aria-hidden="true" tabindex="-1"></a>        vs: <span class="bu">tuple</span>[Velocity, VelocitySolver],</span>
<span id="cb9-332"><a href="#cb9-332" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">-&gt;</span> <span class="bu">tuple</span>[Velocity, VelocitySolver]:</span>
<span id="cb9-333"><a href="#cb9-333" aria-hidden="true" tabindex="-1"></a>        v_i, solver_i <span class="op">=</span> vs</span>
<span id="cb9-334"><a href="#cb9-334" aria-hidden="true" tabindex="-1"></a>        solver_i1 <span class="op">=</span> apply_velocity_normal(contact, helper, solver_i)</span>
<span id="cb9-335"><a href="#cb9-335" aria-hidden="true" tabindex="-1"></a>        v_i1 <span class="op">=</span> _pv_gather(solver_i1.v1, solver_i1.v2, v_i) <span class="op">+</span> v_i</span>
<span id="cb9-336"><a href="#cb9-336" aria-hidden="true" tabindex="-1"></a>        v1, v2 <span class="op">=</span> tree_map2(generate_self_pairs, v_i1)</span>
<span id="cb9-337"><a href="#cb9-337" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> v_i1, solver_i1.replace(v1<span class="op">=</span>v1, v2<span class="op">=</span>v2)</span>
<span id="cb9-338"><a href="#cb9-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-339"><a href="#cb9-339" aria-hidden="true" tabindex="-1"></a>    v, solver <span class="op">=</span> jax.lax.fori_loop(<span class="dv">0</span>, space.n_velocity_iter, vstep, (v, solver))</span>
<span id="cb9-340"><a href="#cb9-340" aria-hidden="true" tabindex="-1"></a>    rest_v1, rest_v2 <span class="op">=</span> apply_bounce(contact, helper, solver)</span>
<span id="cb9-341"><a href="#cb9-341" aria-hidden="true" tabindex="-1"></a>    v <span class="op">=</span> _pv_gather(rest_v1, rest_v2, v) <span class="op">+</span> v</span>
<span id="cb9-342"><a href="#cb9-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-343"><a href="#cb9-343" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> pstep(</span>
<span id="cb9-344"><a href="#cb9-344" aria-hidden="true" tabindex="-1"></a>        _n_iter: <span class="bu">int</span>,</span>
<span id="cb9-345"><a href="#cb9-345" aria-hidden="true" tabindex="-1"></a>        ps: <span class="bu">tuple</span>[Position, PositionSolver],</span>
<span id="cb9-346"><a href="#cb9-346" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">-&gt;</span> <span class="bu">tuple</span>[Position, PositionSolver]:</span>
<span id="cb9-347"><a href="#cb9-347" aria-hidden="true" tabindex="-1"></a>        p_i, solver_i <span class="op">=</span> ps</span>
<span id="cb9-348"><a href="#cb9-348" aria-hidden="true" tabindex="-1"></a>        solver_i1 <span class="op">=</span> correct_position(</span>
<span id="cb9-349"><a href="#cb9-349" aria-hidden="true" tabindex="-1"></a>            space.bias_factor,</span>
<span id="cb9-350"><a href="#cb9-350" aria-hidden="true" tabindex="-1"></a>            space.linear_slop,</span>
<span id="cb9-351"><a href="#cb9-351" aria-hidden="true" tabindex="-1"></a>            space.max_linear_correction,</span>
<span id="cb9-352"><a href="#cb9-352" aria-hidden="true" tabindex="-1"></a>            contact,</span>
<span id="cb9-353"><a href="#cb9-353" aria-hidden="true" tabindex="-1"></a>            helper,</span>
<span id="cb9-354"><a href="#cb9-354" aria-hidden="true" tabindex="-1"></a>            solver_i,</span>
<span id="cb9-355"><a href="#cb9-355" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb9-356"><a href="#cb9-356" aria-hidden="true" tabindex="-1"></a>        p_i1 <span class="op">=</span> _pv_gather(solver_i1.p1, solver_i1.p2, p_i) <span class="op">+</span> p_i</span>
<span id="cb9-357"><a href="#cb9-357" aria-hidden="true" tabindex="-1"></a>        p1, p2 <span class="op">=</span> tree_map2(generate_self_pairs, p_i1)</span>
<span id="cb9-358"><a href="#cb9-358" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> p_i1, solver_i1.replace(p1<span class="op">=</span>p1, p2<span class="op">=</span>p2)</span>
<span id="cb9-359"><a href="#cb9-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-360"><a href="#cb9-360" aria-hidden="true" tabindex="-1"></a>    pos_solver <span class="op">=</span> PositionSolver(</span>
<span id="cb9-361"><a href="#cb9-361" aria-hidden="true" tabindex="-1"></a>        p1<span class="op">=</span>p1,</span>
<span id="cb9-362"><a href="#cb9-362" aria-hidden="true" tabindex="-1"></a>        p2<span class="op">=</span>p2,</span>
<span id="cb9-363"><a href="#cb9-363" aria-hidden="true" tabindex="-1"></a>        contact<span class="op">=</span>solver.contact,</span>
<span id="cb9-364"><a href="#cb9-364" aria-hidden="true" tabindex="-1"></a>        min_separation<span class="op">=</span>jnp.zeros_like(p1.angle),</span>
<span id="cb9-365"><a href="#cb9-365" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-366"><a href="#cb9-366" aria-hidden="true" tabindex="-1"></a>    p, pos_solver <span class="op">=</span> jax.lax.fori_loop(<span class="dv">0</span>, space.n_position_iter, pstep, (p, pos_solver))</span>
<span id="cb9-367"><a href="#cb9-367" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> v, p, solver</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>なかなか複雑になりましたが、実装できました。衝突させてみましょう。</p>
<div class="cell" data-tags="[]" data-execution_count="50">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> celluloid <span class="im">import</span> Camera</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> HTML</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> animate_balls(</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    fig,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    ax: Axes,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    circles: Circle,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    positions: Iterable[Position],</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> HTML:</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    pos <span class="op">=</span> <span class="bu">list</span>(positions)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    camera <span class="op">=</span> Camera(fig)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    circle_list <span class="op">=</span> circles.tolist()</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> pi <span class="kw">in</span> pos:</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> pij, circle <span class="kw">in</span> <span class="bu">zip</span>(pi.tolist(), circle_list):</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>            circle_patch <span class="op">=</span> CirclePatch(</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>                xy<span class="op">=</span>pij.xy,</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>                radius<span class="op">=</span>circle.radius,</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>                fill<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>                color<span class="op">=</span>circle.rgba.tolist(),</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>            ax.add_patch(circle_patch)</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>        camera.snap()</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> HTML(camera.animate().to_html5_video())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-tags="[]" data-execution_count="51">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>space <span class="op">=</span> Space(gravity<span class="op">=</span>jnp.array([<span class="fl">0.0</span>, <span class="op">-</span><span class="fl">9.8</span>]), dt<span class="op">=</span><span class="fl">0.04</span>, bias_factor<span class="op">=</span><span class="fl">0.2</span>, circle<span class="op">=</span>circles)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> State(p<span class="op">=</span>p, v<span class="op">=</span>v, f<span class="op">=</span>f, is_active<span class="op">=</span>jnp.ones(N, dtype<span class="op">=</span><span class="bu">bool</span>))</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>positions <span class="op">=</span> [state.p]</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>solver <span class="op">=</span> init_solver(N <span class="op">*</span> (N <span class="op">-</span> <span class="dv">1</span>) <span class="op">//</span> <span class="dv">2</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="at">@jax.jit</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> step(state: State, solver: VelocitySolver) <span class="op">-&gt;</span> <span class="bu">tuple</span>[State, VelocitySolver]:</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    state <span class="op">=</span> update_velocity(space, space.circle, state)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    contacts, c1, c2 <span class="op">=</span> check_circle_to_circle(space, state.p, state.is_active)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    v, p, solver <span class="op">=</span> apply_seq_impulses(</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>        space,</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>        solver.update(contacts.penetration <span class="op">&gt;=</span> <span class="dv">0</span>),</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>        state.p,</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>        state.v,</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>        contacts,</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>        c1,</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>        c2,</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> update_position(space, state.replace(v<span class="op">=</span>v, p<span class="op">=</span>p)), solver</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">30</span>):</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>    state, solver <span class="op">=</span> step(state, solver)</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>    positions.append(state.p)</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>ax.set_aspect(<span class="st">"equal"</span>, adjustable<span class="op">=</span><span class="st">"box"</span>)</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>ax.set_xlim((<span class="op">-</span><span class="dv">10</span>, <span class="dv">10</span>))</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>ax.set_ylim((<span class="op">-</span><span class="dv">10</span>, <span class="dv">10</span>))</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>animate_balls(fig, ax, space.circle, positions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="51">
<video width="640" height="480" controls="" autoplay="" loop="">
  <source type="video/mp4" src="data:video/mp4;base64,AAAAIGZ0eXBNNFYgAAACAE00ViBpc29taXNvMmF2YzEAAAAIZnJlZQAAVJhtZGF0AAACrgYF//+q
3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE2NCByMzA5NSBiYWVlNDAwIC0gSC4yNjQvTVBF
Ry00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAyMiAtIGh0dHA6Ly93d3cudmlkZW9sYW4u
b3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTMgZGVibG9jaz0xOjA6MCBhbmFs
eXNlPTB4MzoweDExMyBtZT1oZXggc3VibWU9NyBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVk
X3JlZj0xIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MSA4eDhkY3Q9MSBjcW09MCBk
ZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0tMiB0aHJlYWRzPTE1
IGxvb2thaGVhZF90aHJlYWRzPTIgc2xpY2VkX3RocmVhZHM9MCBucj0wIGRlY2ltYXRlPTEgaW50
ZXJsYWNlZD0wIGJsdXJheV9jb21wYXQ9MCBjb25zdHJhaW5lZF9pbnRyYT0wIGJmcmFtZXM9MyBi
X3B5cmFtaWQ9MiBiX2FkYXB0PTEgYl9iaWFzPTAgZGlyZWN0PTEgd2VpZ2h0Yj0xIG9wZW5fZ29w
PTAgd2VpZ2h0cD0yIGtleWludD0yNTAga2V5aW50X21pbj01IHNjZW5lY3V0PTQwIGludHJhX3Jl
ZnJlc2g9MCByY19sb29rYWhlYWQ9NDAgcmM9Y3JmIG1idHJlZT0xIGNyZj0yMy4wIHFjb21wPTAu
NjAgcXBtaW49MCBxcG1heD02OSBxcHN0ZXA9NCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAc
d2WIhAAT//73sY+BTcgADZc6inof4RWx9JBRerHZoGTqAAADAAADAAADAigXteKQMJledeAAABkw
A04veMCF+2HAAnSKOR1yq/x9RUUpO7q7FnduFov8JDhXo2Bf88Kc5ltrYz8dTy23P8oF2UPQenGk
gCzitozIEbfoLBmZCEzp9GLbOcI9rnsXRoWUmOMqYJa8B5tg/uXFuBDPPDn07xVSRZb5mgLmX1Pe
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
">
  Your browser does not support the video tag.
</video>
</div>
</div>
<p>最初の衝突で若干のめりこみが発生していますが、一応大丈夫そうですね。</p>
</section>
<section id="線分" class="level2">
<h2 class="anchored" data-anchor-id="線分">線分</h2>
<p>円同士の衝突が実装できたところで、次は凸多角形の実装…と言いたいところですが、それは後回しにして、ゲームには欠かせない「線分」を実装してみます。現実世界にはそんなもの存在しないのですが、ゲームやシミュレーションの世界では、どうしても地面や柵といった境界を表現する必要が生じてきます。こういったものを例えば「めちゃくちゃ重い長方形」として表現することもできますが、シミュレーションを組むユーザー側からするといちいち長方形の大きさだったりを定義するのは面倒なので、「無限の質量を持つ線」として扱えたほうが楽ですよね。というわけで線分を実装してみます。線分の衝突判定は薬のカプセル💊のように両端が丸くなっているやつ(Box2Dだとカプセルと呼ばれているのでカプセルと呼びます)と実装がほぼ同じなので、カプセルも一緒に実装してしまいます。ただカプセル同士の衝突は面倒なので、とりあえず円とカプセルだけ実装しましょう。新しい図形を加えたので、<code>Space</code>も作り直す必要があります。とりあえず<code>dataclass</code>に全シェイプをつっこんでおいて、各シェイプの組み合わせごとに衝突判定を行い、衝突解決のときは<code>jnp.concatenate</code>で全部くっつけてから<code>vmap</code>で一度にやるという実装方針にしました。さっきのペアに対するループをアンロールするところは、インデックスのペアを持っておいて適当なオフセットを足しておけばそのまま使えます。</p>
<div class="cell" data-tags="[]" data-execution_count="60">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.patches <span class="im">import</span> Rectangle</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="at">@chex.dataclass</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Capsule(Shape):</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    length: jax.Array</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    radius: jax.Array</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="at">@chex.dataclass</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Segment(Shape):</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    length: jax.Array</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> to_capsule(<span class="va">self</span>) <span class="op">-&gt;</span> Capsule:</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Capsule(</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>            mass<span class="op">=</span><span class="va">self</span>.mass,</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>            moment<span class="op">=</span><span class="va">self</span>.moment,</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>            elasticity<span class="op">=</span><span class="va">self</span>.elasticity,</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>            friction<span class="op">=</span><span class="va">self</span>.friction,</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>            rgba<span class="op">=</span><span class="va">self</span>.rgba,</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>            length<span class="op">=</span><span class="va">self</span>.length,</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>            radius<span class="op">=</span>jnp.zeros_like(<span class="va">self</span>.length),</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _length_to_points(length: jax.Array) <span class="op">-&gt;</span> <span class="bu">tuple</span>[jax.Array, jax.Array]:</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> jnp.stack((length <span class="op">*</span> <span class="op">-</span><span class="fl">0.5</span>, length <span class="op">*</span> <span class="fl">0.0</span>), axis<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> jnp.stack((length <span class="op">*</span> <span class="fl">0.5</span>, length <span class="op">*</span> <span class="fl">0.0</span>), axis<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a, b</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a><span class="at">@jax.vmap</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _capsule_to_circle_impl(</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    a: Capsule,</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    b: Circle,</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    a_pos: Position,</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>    b_pos: Position,</span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>    isactive: jax.Array,</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> Contact:</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Move b_pos to capsule's coordinates</span></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>    pb <span class="op">=</span> a_pos.inv_transform(b_pos.xy)</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>    p1, p2 <span class="op">=</span> _length_to_points(a.length)</span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>    edge <span class="op">=</span> p2 <span class="op">-</span> p1</span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>    s1 <span class="op">=</span> jnp.dot(pb <span class="op">-</span> p1, edge)</span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>    s2 <span class="op">=</span> jnp.dot(p2 <span class="op">-</span> pb, edge)</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>    in_segment <span class="op">=</span> jnp.logical_and(s1 <span class="op">&gt;=</span> <span class="fl">0.0</span>, s2 <span class="op">&gt;=</span> <span class="fl">0.0</span>)</span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>    ee <span class="op">=</span> jnp.<span class="bu">sum</span>(jnp.square(edge), axis<span class="op">=-</span><span class="dv">1</span>, keepdims<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Closest point</span></span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># s1 &lt; 0: pb is left to the capsule</span></span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># s2 &lt; 0: pb is right to the capsule</span></span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># else: pb is in between capsule</span></span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>    pa <span class="op">=</span> jax.lax.select(</span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>        in_segment,</span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a>        p1 <span class="op">+</span> edge <span class="op">*</span> s1 <span class="op">/</span> ee,</span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>        jax.lax.select(s1 <span class="op">&lt;</span> <span class="fl">0.0</span>, p1, p2),</span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a>    a2b_normal, dist <span class="op">=</span> normalize(pb <span class="op">-</span> pa)</span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a>    penetration <span class="op">=</span> a.radius <span class="op">+</span> b.radius <span class="op">-</span> dist</span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a>    a_contact <span class="op">=</span> pa <span class="op">+</span> a2b_normal <span class="op">*</span> a.radius</span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a>    b_contact <span class="op">=</span> pb <span class="op">-</span> a2b_normal <span class="op">*</span> b.radius</span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a>    pos <span class="op">=</span> a_pos.transform((a_contact <span class="op">+</span> b_contact) <span class="op">*</span> <span class="fl">0.5</span>)</span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a>    xy_zeros <span class="op">=</span> jnp.zeros_like(b_pos.xy)</span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a>    a2b_normal_rotated <span class="op">=</span> a_pos.replace(xy<span class="op">=</span>xy_zeros).transform(a2b_normal)</span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter penetration</span></span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a>    penetration <span class="op">=</span> jnp.where(isactive, penetration, jnp.ones_like(penetration) <span class="op">*</span> <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Contact(</span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a>        pos<span class="op">=</span>pos,</span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a>        normal<span class="op">=</span>a2b_normal_rotated,</span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a>        penetration<span class="op">=</span>penetration,</span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a>        elasticity<span class="op">=</span>(a.elasticity <span class="op">+</span> b.elasticity) <span class="op">*</span> <span class="fl">0.5</span>,</span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a>        friction<span class="op">=</span>(a.friction <span class="op">+</span> b.friction) <span class="op">*</span> <span class="fl">0.5</span>,</span>
<span id="cb12-71"><a href="#cb12-71" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-72"><a href="#cb12-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-73"><a href="#cb12-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-74"><a href="#cb12-74" aria-hidden="true" tabindex="-1"></a><span class="at">@chex.dataclass</span></span>
<span id="cb12-75"><a href="#cb12-75" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ShapeDict:</span>
<span id="cb12-76"><a href="#cb12-76" aria-hidden="true" tabindex="-1"></a>    circle: Circle <span class="op">|</span> <span class="va">None</span> <span class="op">=</span> <span class="va">None</span></span>
<span id="cb12-77"><a href="#cb12-77" aria-hidden="true" tabindex="-1"></a>    segment: Segment <span class="op">|</span> <span class="va">None</span> <span class="op">=</span> <span class="va">None</span></span>
<span id="cb12-78"><a href="#cb12-78" aria-hidden="true" tabindex="-1"></a>    capsule: Capsule <span class="op">|</span> <span class="va">None</span> <span class="op">=</span> <span class="va">None</span></span>
<span id="cb12-79"><a href="#cb12-79" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-80"><a href="#cb12-80" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> concat(<span class="va">self</span>) <span class="op">-&gt;</span> Shape:</span>
<span id="cb12-81"><a href="#cb12-81" aria-hidden="true" tabindex="-1"></a>        shapes <span class="op">=</span> [s.to_shape() <span class="cf">for</span> s <span class="kw">in</span> <span class="va">self</span>.values() <span class="cf">if</span> s <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>]</span>
<span id="cb12-82"><a href="#cb12-82" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> jax.tree_map(<span class="kw">lambda</span> <span class="op">*</span>args: jnp.concatenate(args, axis<span class="op">=</span><span class="dv">0</span>), <span class="op">*</span>shapes)</span>
<span id="cb12-83"><a href="#cb12-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-84"><a href="#cb12-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-85"><a href="#cb12-85" aria-hidden="true" tabindex="-1"></a><span class="at">@chex.dataclass</span></span>
<span id="cb12-86"><a href="#cb12-86" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> StateDict:</span>
<span id="cb12-87"><a href="#cb12-87" aria-hidden="true" tabindex="-1"></a>    circle: State <span class="op">|</span> <span class="va">None</span> <span class="op">=</span> <span class="va">None</span></span>
<span id="cb12-88"><a href="#cb12-88" aria-hidden="true" tabindex="-1"></a>    segment: State <span class="op">|</span> <span class="va">None</span> <span class="op">=</span> <span class="va">None</span></span>
<span id="cb12-89"><a href="#cb12-89" aria-hidden="true" tabindex="-1"></a>    capsule: State <span class="op">|</span> <span class="va">None</span> <span class="op">=</span> <span class="va">None</span></span>
<span id="cb12-90"><a href="#cb12-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-91"><a href="#cb12-91" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> concat(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb12-92"><a href="#cb12-92" aria-hidden="true" tabindex="-1"></a>        states <span class="op">=</span> [s <span class="cf">for</span> s <span class="kw">in</span> <span class="va">self</span>.values() <span class="cf">if</span> s <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>]</span>
<span id="cb12-93"><a href="#cb12-93" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> jax.tree_map(<span class="kw">lambda</span> <span class="op">*</span>args: jnp.concatenate(args, axis<span class="op">=</span><span class="dv">0</span>), <span class="op">*</span>states)</span>
<span id="cb12-94"><a href="#cb12-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-95"><a href="#cb12-95" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> offset(<span class="va">self</span>, key: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb12-96"><a href="#cb12-96" aria-hidden="true" tabindex="-1"></a>        total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb12-97"><a href="#cb12-97" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> k, state <span class="kw">in</span> <span class="va">self</span>.items():</span>
<span id="cb12-98"><a href="#cb12-98" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> k <span class="op">==</span> key:</span>
<span id="cb12-99"><a href="#cb12-99" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> total</span>
<span id="cb12-100"><a href="#cb12-100" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> state <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb12-101"><a href="#cb12-101" aria-hidden="true" tabindex="-1"></a>                total <span class="op">+=</span> state.p.batch_size()</span>
<span id="cb12-102"><a href="#cb12-102" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">RuntimeError</span>(<span class="st">"Unreachable"</span>)</span>
<span id="cb12-103"><a href="#cb12-103" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb12-104"><a href="#cb12-104" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _get(<span class="va">self</span>, name: <span class="bu">str</span>, state: State) <span class="op">-&gt;</span> State <span class="op">|</span> <span class="va">None</span>:</span>
<span id="cb12-105"><a href="#cb12-105" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>[name] <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb12-106"><a href="#cb12-106" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb12-107"><a href="#cb12-107" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb12-108"><a href="#cb12-108" aria-hidden="true" tabindex="-1"></a>            start <span class="op">=</span> <span class="va">self</span>.offset(name)</span>
<span id="cb12-109"><a href="#cb12-109" aria-hidden="true" tabindex="-1"></a>            end <span class="op">=</span> start <span class="op">+</span> <span class="va">self</span>[name].p.batch_size()</span>
<span id="cb12-110"><a href="#cb12-110" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> state.get_slice(jnp.arange(start, end))</span>
<span id="cb12-111"><a href="#cb12-111" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb12-112"><a href="#cb12-112" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> update(<span class="va">self</span>, statec: State) <span class="op">-&gt;</span> Self:</span>
<span id="cb12-113"><a href="#cb12-113" aria-hidden="true" tabindex="-1"></a>        circle <span class="op">=</span> <span class="va">self</span>._get(<span class="st">"circle"</span>, statec)</span>
<span id="cb12-114"><a href="#cb12-114" aria-hidden="true" tabindex="-1"></a>        segment <span class="op">=</span> <span class="va">self</span>._get(<span class="st">"segment"</span>, statec)</span>
<span id="cb12-115"><a href="#cb12-115" aria-hidden="true" tabindex="-1"></a>        capsule <span class="op">=</span> <span class="va">self</span>._get(<span class="st">"capsule"</span>, statec)</span>
<span id="cb12-116"><a href="#cb12-116" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.__class__(circle<span class="op">=</span>circle, segment<span class="op">=</span>segment, capsule<span class="op">=</span>capsule)</span>
<span id="cb12-117"><a href="#cb12-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-118"><a href="#cb12-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-119"><a href="#cb12-119" aria-hidden="true" tabindex="-1"></a>ContactFn <span class="op">=</span> Callable[[StateDict], <span class="bu">tuple</span>[Contact, Shape, Shape]]</span>
<span id="cb12-120"><a href="#cb12-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-121"><a href="#cb12-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-122"><a href="#cb12-122" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _pair_outer(x: jax.Array, reps: <span class="bu">int</span>) <span class="op">-&gt;</span> jax.Array:</span>
<span id="cb12-123"><a href="#cb12-123" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> jnp.repeat(x, reps, axis<span class="op">=</span><span class="dv">0</span>, total_repeat_length<span class="op">=</span>x.shape[<span class="dv">0</span>] <span class="op">*</span> reps)</span>
<span id="cb12-124"><a href="#cb12-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-125"><a href="#cb12-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-126"><a href="#cb12-126" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _pair_inner(x: jax.Array, reps: <span class="bu">int</span>) <span class="op">-&gt;</span> jax.Array:</span>
<span id="cb12-127"><a href="#cb12-127" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> jnp.tile(x, (reps,) <span class="op">+</span> (<span class="dv">1</span>,) <span class="op">*</span> (x.ndim <span class="op">-</span> <span class="dv">1</span>))</span>
<span id="cb12-128"><a href="#cb12-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-129"><a href="#cb12-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-130"><a href="#cb12-130" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_pairs(x: jax.Array, y: jax.Array) <span class="op">-&gt;</span> <span class="bu">tuple</span>[jax.Array, jax.Array]:</span>
<span id="cb12-131"><a href="#cb12-131" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Returns two arrays that iterate over all combination of elements in x and y"""</span></span>
<span id="cb12-132"><a href="#cb12-132" aria-hidden="true" tabindex="-1"></a>    xlen, ylen <span class="op">=</span> x.shape[<span class="dv">0</span>], y.shape[<span class="dv">0</span>]</span>
<span id="cb12-133"><a href="#cb12-133" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> _pair_outer(x, ylen), _pair_inner(y, xlen)</span>
<span id="cb12-134"><a href="#cb12-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-135"><a href="#cb12-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-136"><a href="#cb12-136" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _circle_to_circle(</span>
<span id="cb12-137"><a href="#cb12-137" aria-hidden="true" tabindex="-1"></a>    shaped: ShapeDict,</span>
<span id="cb12-138"><a href="#cb12-138" aria-hidden="true" tabindex="-1"></a>    stated: StateDict,</span>
<span id="cb12-139"><a href="#cb12-139" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> <span class="bu">tuple</span>[Contact, Circle, Circle]:</span>
<span id="cb12-140"><a href="#cb12-140" aria-hidden="true" tabindex="-1"></a>    circle1, circle2 <span class="op">=</span> tree_map2(generate_self_pairs, shaped.circle)</span>
<span id="cb12-141"><a href="#cb12-141" aria-hidden="true" tabindex="-1"></a>    pos1, pos2 <span class="op">=</span> tree_map2(generate_self_pairs, stated.circle.p)</span>
<span id="cb12-142"><a href="#cb12-142" aria-hidden="true" tabindex="-1"></a>    is_active <span class="op">=</span> jnp.logical_and(<span class="op">*</span>generate_self_pairs(stated.circle.is_active))</span>
<span id="cb12-143"><a href="#cb12-143" aria-hidden="true" tabindex="-1"></a>    contacts <span class="op">=</span> _circle_to_circle_impl(</span>
<span id="cb12-144"><a href="#cb12-144" aria-hidden="true" tabindex="-1"></a>        circle1,</span>
<span id="cb12-145"><a href="#cb12-145" aria-hidden="true" tabindex="-1"></a>        circle2,</span>
<span id="cb12-146"><a href="#cb12-146" aria-hidden="true" tabindex="-1"></a>        pos1,</span>
<span id="cb12-147"><a href="#cb12-147" aria-hidden="true" tabindex="-1"></a>        pos2,</span>
<span id="cb12-148"><a href="#cb12-148" aria-hidden="true" tabindex="-1"></a>        is_active,</span>
<span id="cb12-149"><a href="#cb12-149" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-150"><a href="#cb12-150" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> contacts, circle1, circle2</span>
<span id="cb12-151"><a href="#cb12-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-152"><a href="#cb12-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-153"><a href="#cb12-153" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _capsule_to_circle(</span>
<span id="cb12-154"><a href="#cb12-154" aria-hidden="true" tabindex="-1"></a>    shaped: ShapeDict,</span>
<span id="cb12-155"><a href="#cb12-155" aria-hidden="true" tabindex="-1"></a>    stated: StateDict,</span>
<span id="cb12-156"><a href="#cb12-156" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> <span class="bu">tuple</span>[Contact, Capsule, Circle]:</span>
<span id="cb12-157"><a href="#cb12-157" aria-hidden="true" tabindex="-1"></a>    capsule <span class="op">=</span> jax.tree_map(</span>
<span id="cb12-158"><a href="#cb12-158" aria-hidden="true" tabindex="-1"></a>        functools.partial(_pair_outer, reps<span class="op">=</span>shaped.circle.mass.shape[<span class="dv">0</span>]),</span>
<span id="cb12-159"><a href="#cb12-159" aria-hidden="true" tabindex="-1"></a>        shaped.capsule,</span>
<span id="cb12-160"><a href="#cb12-160" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-161"><a href="#cb12-161" aria-hidden="true" tabindex="-1"></a>    circle <span class="op">=</span> jax.tree_map(</span>
<span id="cb12-162"><a href="#cb12-162" aria-hidden="true" tabindex="-1"></a>        functools.partial(_pair_inner, reps<span class="op">=</span>shaped.capsule.mass.shape[<span class="dv">0</span>]),</span>
<span id="cb12-163"><a href="#cb12-163" aria-hidden="true" tabindex="-1"></a>        shaped.circle,</span>
<span id="cb12-164"><a href="#cb12-164" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-165"><a href="#cb12-165" aria-hidden="true" tabindex="-1"></a>    pos1, pos2 <span class="op">=</span> tree_map2(generate_pairs, stated.capsule.p, stated.circle.p)</span>
<span id="cb12-166"><a href="#cb12-166" aria-hidden="true" tabindex="-1"></a>    is_active <span class="op">=</span> jnp.logical_and(</span>
<span id="cb12-167"><a href="#cb12-167" aria-hidden="true" tabindex="-1"></a>        <span class="op">*</span>generate_pairs(stated.capsule.is_active, stated.circle.is_active)</span>
<span id="cb12-168"><a href="#cb12-168" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-169"><a href="#cb12-169" aria-hidden="true" tabindex="-1"></a>    contacts <span class="op">=</span> _capsule_to_circle_impl(</span>
<span id="cb12-170"><a href="#cb12-170" aria-hidden="true" tabindex="-1"></a>        capsule,</span>
<span id="cb12-171"><a href="#cb12-171" aria-hidden="true" tabindex="-1"></a>        circle,</span>
<span id="cb12-172"><a href="#cb12-172" aria-hidden="true" tabindex="-1"></a>        pos1,</span>
<span id="cb12-173"><a href="#cb12-173" aria-hidden="true" tabindex="-1"></a>        pos2,</span>
<span id="cb12-174"><a href="#cb12-174" aria-hidden="true" tabindex="-1"></a>        is_active,</span>
<span id="cb12-175"><a href="#cb12-175" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-176"><a href="#cb12-176" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> contacts, capsule, circle</span>
<span id="cb12-177"><a href="#cb12-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-178"><a href="#cb12-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-179"><a href="#cb12-179" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _segment_to_circle(</span>
<span id="cb12-180"><a href="#cb12-180" aria-hidden="true" tabindex="-1"></a>    shaped: ShapeDict,</span>
<span id="cb12-181"><a href="#cb12-181" aria-hidden="true" tabindex="-1"></a>    stated: StateDict,</span>
<span id="cb12-182"><a href="#cb12-182" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> <span class="bu">tuple</span>[Contact, Segment, Circle]:</span>
<span id="cb12-183"><a href="#cb12-183" aria-hidden="true" tabindex="-1"></a>    segment <span class="op">=</span> jax.tree_map(</span>
<span id="cb12-184"><a href="#cb12-184" aria-hidden="true" tabindex="-1"></a>        functools.partial(_pair_outer, reps<span class="op">=</span>shaped.circle.mass.shape[<span class="dv">0</span>]),</span>
<span id="cb12-185"><a href="#cb12-185" aria-hidden="true" tabindex="-1"></a>        shaped.segment,</span>
<span id="cb12-186"><a href="#cb12-186" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-187"><a href="#cb12-187" aria-hidden="true" tabindex="-1"></a>    circle <span class="op">=</span> jax.tree_map(</span>
<span id="cb12-188"><a href="#cb12-188" aria-hidden="true" tabindex="-1"></a>        functools.partial(_pair_inner, reps<span class="op">=</span>shaped.segment.mass.shape[<span class="dv">0</span>]),</span>
<span id="cb12-189"><a href="#cb12-189" aria-hidden="true" tabindex="-1"></a>        shaped.circle,</span>
<span id="cb12-190"><a href="#cb12-190" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-191"><a href="#cb12-191" aria-hidden="true" tabindex="-1"></a>    pos1, pos2 <span class="op">=</span> tree_map2(generate_pairs, stated.segment.p, stated.circle.p)</span>
<span id="cb12-192"><a href="#cb12-192" aria-hidden="true" tabindex="-1"></a>    is_active <span class="op">=</span> jnp.logical_and(</span>
<span id="cb12-193"><a href="#cb12-193" aria-hidden="true" tabindex="-1"></a>        <span class="op">*</span>generate_pairs(stated.segment.is_active, stated.circle.is_active)</span>
<span id="cb12-194"><a href="#cb12-194" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-195"><a href="#cb12-195" aria-hidden="true" tabindex="-1"></a>    contacts <span class="op">=</span> _capsule_to_circle_impl(</span>
<span id="cb12-196"><a href="#cb12-196" aria-hidden="true" tabindex="-1"></a>        segment.to_capsule(),</span>
<span id="cb12-197"><a href="#cb12-197" aria-hidden="true" tabindex="-1"></a>        circle,</span>
<span id="cb12-198"><a href="#cb12-198" aria-hidden="true" tabindex="-1"></a>        pos1,</span>
<span id="cb12-199"><a href="#cb12-199" aria-hidden="true" tabindex="-1"></a>        pos2,</span>
<span id="cb12-200"><a href="#cb12-200" aria-hidden="true" tabindex="-1"></a>        is_active,</span>
<span id="cb12-201"><a href="#cb12-201" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-202"><a href="#cb12-202" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> contacts, segment, circle</span>
<span id="cb12-203"><a href="#cb12-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-204"><a href="#cb12-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-205"><a href="#cb12-205" aria-hidden="true" tabindex="-1"></a>_CONTACT_FUNCTIONS <span class="op">=</span> {</span>
<span id="cb12-206"><a href="#cb12-206" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"circle"</span>, <span class="st">"circle"</span>): _circle_to_circle,</span>
<span id="cb12-207"><a href="#cb12-207" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"capsule"</span>, <span class="st">"circle"</span>): _capsule_to_circle,</span>
<span id="cb12-208"><a href="#cb12-208" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"segment"</span>, <span class="st">"circle"</span>): _segment_to_circle,</span>
<span id="cb12-209"><a href="#cb12-209" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-210"><a href="#cb12-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-211"><a href="#cb12-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-212"><a href="#cb12-212" aria-hidden="true" tabindex="-1"></a><span class="at">@chex.dataclass</span></span>
<span id="cb12-213"><a href="#cb12-213" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ContactWithMetadata:</span>
<span id="cb12-214"><a href="#cb12-214" aria-hidden="true" tabindex="-1"></a>    contact: Contact</span>
<span id="cb12-215"><a href="#cb12-215" aria-hidden="true" tabindex="-1"></a>    shape1: Shape</span>
<span id="cb12-216"><a href="#cb12-216" aria-hidden="true" tabindex="-1"></a>    shape2: Shape</span>
<span id="cb12-217"><a href="#cb12-217" aria-hidden="true" tabindex="-1"></a>    outer_index: jax.Array</span>
<span id="cb12-218"><a href="#cb12-218" aria-hidden="true" tabindex="-1"></a>    inner_index: jax.Array</span>
<span id="cb12-219"><a href="#cb12-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-220"><a href="#cb12-220" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> gather_p_or_v(</span>
<span id="cb12-221"><a href="#cb12-221" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>,</span>
<span id="cb12-222"><a href="#cb12-222" aria-hidden="true" tabindex="-1"></a>        outer: _PositionLike,</span>
<span id="cb12-223"><a href="#cb12-223" aria-hidden="true" tabindex="-1"></a>        inner: _PositionLike,</span>
<span id="cb12-224"><a href="#cb12-224" aria-hidden="true" tabindex="-1"></a>        orig: _PositionLike,</span>
<span id="cb12-225"><a href="#cb12-225" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">-&gt;</span> _PositionLike:</span>
<span id="cb12-226"><a href="#cb12-226" aria-hidden="true" tabindex="-1"></a>        xy_outer <span class="op">=</span> jnp.zeros_like(orig.xy).at[<span class="va">self</span>.outer_index].add(outer.xy)</span>
<span id="cb12-227"><a href="#cb12-227" aria-hidden="true" tabindex="-1"></a>        angle_outer <span class="op">=</span> jnp.zeros_like(orig.angle).at[<span class="va">self</span>.outer_index].add(outer.angle)</span>
<span id="cb12-228"><a href="#cb12-228" aria-hidden="true" tabindex="-1"></a>        xy_inner <span class="op">=</span> jnp.zeros_like(orig.xy).at[<span class="va">self</span>.inner_index].add(inner.xy)</span>
<span id="cb12-229"><a href="#cb12-229" aria-hidden="true" tabindex="-1"></a>        angle_inner <span class="op">=</span> jnp.zeros_like(orig.angle).at[<span class="va">self</span>.inner_index].add(inner.angle)</span>
<span id="cb12-230"><a href="#cb12-230" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> orig.__class__(angle<span class="op">=</span>angle_outer <span class="op">+</span> angle_inner, xy<span class="op">=</span>xy_outer <span class="op">+</span> xy_inner)</span>
<span id="cb12-231"><a href="#cb12-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-232"><a href="#cb12-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-233"><a href="#cb12-233" aria-hidden="true" tabindex="-1"></a><span class="at">@chex.dataclass</span></span>
<span id="cb12-234"><a href="#cb12-234" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ExtendedSpace:</span>
<span id="cb12-235"><a href="#cb12-235" aria-hidden="true" tabindex="-1"></a>    gravity: jax.Array</span>
<span id="cb12-236"><a href="#cb12-236" aria-hidden="true" tabindex="-1"></a>    shaped: ShapeDict</span>
<span id="cb12-237"><a href="#cb12-237" aria-hidden="true" tabindex="-1"></a>    dt: jax.Array <span class="op">|</span> <span class="bu">float</span> <span class="op">=</span> <span class="fl">0.1</span></span>
<span id="cb12-238"><a href="#cb12-238" aria-hidden="true" tabindex="-1"></a>    linear_damping: jax.Array <span class="op">|</span> <span class="bu">float</span> <span class="op">=</span> <span class="fl">0.95</span></span>
<span id="cb12-239"><a href="#cb12-239" aria-hidden="true" tabindex="-1"></a>    angular_damping: jax.Array <span class="op">|</span> <span class="bu">float</span> <span class="op">=</span> <span class="fl">0.95</span></span>
<span id="cb12-240"><a href="#cb12-240" aria-hidden="true" tabindex="-1"></a>    bias_factor: jax.Array <span class="op">|</span> <span class="bu">float</span> <span class="op">=</span> <span class="fl">0.2</span></span>
<span id="cb12-241"><a href="#cb12-241" aria-hidden="true" tabindex="-1"></a>    n_velocity_iter: <span class="bu">int</span> <span class="op">=</span> <span class="dv">8</span></span>
<span id="cb12-242"><a href="#cb12-242" aria-hidden="true" tabindex="-1"></a>    n_position_iter: <span class="bu">int</span> <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb12-243"><a href="#cb12-243" aria-hidden="true" tabindex="-1"></a>    linear_slop: jax.Array <span class="op">|</span> <span class="bu">float</span> <span class="op">=</span> <span class="fl">0.005</span></span>
<span id="cb12-244"><a href="#cb12-244" aria-hidden="true" tabindex="-1"></a>    max_linear_correction: jax.Array <span class="op">|</span> <span class="bu">float</span> <span class="op">=</span> <span class="fl">0.2</span></span>
<span id="cb12-245"><a href="#cb12-245" aria-hidden="true" tabindex="-1"></a>    allowed_penetration: jax.Array <span class="op">|</span> <span class="bu">float</span> <span class="op">=</span> <span class="fl">0.005</span></span>
<span id="cb12-246"><a href="#cb12-246" aria-hidden="true" tabindex="-1"></a>    bounce_threshold: <span class="bu">float</span> <span class="op">=</span> <span class="fl">1.0</span></span>
<span id="cb12-247"><a href="#cb12-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-248"><a href="#cb12-248" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> check_contacts(<span class="va">self</span>, stated: StateDict) <span class="op">-&gt;</span> ContactWithMetadata:</span>
<span id="cb12-249"><a href="#cb12-249" aria-hidden="true" tabindex="-1"></a>        contacts <span class="op">=</span> []</span>
<span id="cb12-250"><a href="#cb12-250" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (n1, n2), fn <span class="kw">in</span> _CONTACT_FUNCTIONS.items():</span>
<span id="cb12-251"><a href="#cb12-251" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> stated[n1] <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> stated[n2] <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb12-252"><a href="#cb12-252" aria-hidden="true" tabindex="-1"></a>                contact, shape1, shape2 <span class="op">=</span> fn(<span class="va">self</span>.shaped, stated)</span>
<span id="cb12-253"><a href="#cb12-253" aria-hidden="true" tabindex="-1"></a>                len1, len2 <span class="op">=</span> stated[n1].p.batch_size(), stated[n2].p.batch_size()</span>
<span id="cb12-254"><a href="#cb12-254" aria-hidden="true" tabindex="-1"></a>                offset1, offset2 <span class="op">=</span> stated.offset(n1), stated.offset(n2)</span>
<span id="cb12-255"><a href="#cb12-255" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> n1 <span class="op">==</span> n2:</span>
<span id="cb12-256"><a href="#cb12-256" aria-hidden="true" tabindex="-1"></a>                    outer_index, inner_index <span class="op">=</span> generate_self_pairs(jnp.arange(len1))</span>
<span id="cb12-257"><a href="#cb12-257" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb12-258"><a href="#cb12-258" aria-hidden="true" tabindex="-1"></a>                    outer_index, inner_index <span class="op">=</span> generate_pairs(</span>
<span id="cb12-259"><a href="#cb12-259" aria-hidden="true" tabindex="-1"></a>                        jnp.arange(len1),</span>
<span id="cb12-260"><a href="#cb12-260" aria-hidden="true" tabindex="-1"></a>                        jnp.arange(len2),</span>
<span id="cb12-261"><a href="#cb12-261" aria-hidden="true" tabindex="-1"></a>                    )</span>
<span id="cb12-262"><a href="#cb12-262" aria-hidden="true" tabindex="-1"></a>                contact_with_meta <span class="op">=</span> ContactWithMetadata(</span>
<span id="cb12-263"><a href="#cb12-263" aria-hidden="true" tabindex="-1"></a>                    contact<span class="op">=</span>contact,</span>
<span id="cb12-264"><a href="#cb12-264" aria-hidden="true" tabindex="-1"></a>                    shape1<span class="op">=</span>shape1.to_shape(),</span>
<span id="cb12-265"><a href="#cb12-265" aria-hidden="true" tabindex="-1"></a>                    shape2<span class="op">=</span>shape2.to_shape(),</span>
<span id="cb12-266"><a href="#cb12-266" aria-hidden="true" tabindex="-1"></a>                    outer_index<span class="op">=</span>outer_index <span class="op">+</span> offset1,</span>
<span id="cb12-267"><a href="#cb12-267" aria-hidden="true" tabindex="-1"></a>                    inner_index<span class="op">=</span>inner_index <span class="op">+</span> offset2,</span>
<span id="cb12-268"><a href="#cb12-268" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb12-269"><a href="#cb12-269" aria-hidden="true" tabindex="-1"></a>                contacts.append(contact_with_meta)</span>
<span id="cb12-270"><a href="#cb12-270" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> jax.tree_map(<span class="kw">lambda</span> <span class="op">*</span>args: jnp.concatenate(args, axis<span class="op">=</span><span class="dv">0</span>), <span class="op">*</span>contacts)</span>
<span id="cb12-271"><a href="#cb12-271" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-272"><a href="#cb12-272" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> n_possible_contacts(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb12-273"><a href="#cb12-273" aria-hidden="true" tabindex="-1"></a>        n <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb12-274"><a href="#cb12-274" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> n1, n2 <span class="kw">in</span> _CONTACT_FUNCTIONS.keys():</span>
<span id="cb12-275"><a href="#cb12-275" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.shaped[n1] <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> <span class="va">self</span>.shaped[n2] <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb12-276"><a href="#cb12-276" aria-hidden="true" tabindex="-1"></a>                len1, len2 <span class="op">=</span> <span class="bu">len</span>(<span class="va">self</span>.shaped[n1].mass), <span class="bu">len</span>(<span class="va">self</span>.shaped[n2].mass)</span>
<span id="cb12-277"><a href="#cb12-277" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> n1 <span class="op">==</span> n2:</span>
<span id="cb12-278"><a href="#cb12-278" aria-hidden="true" tabindex="-1"></a>                    n <span class="op">+=</span> len1 <span class="op">*</span> (len1 <span class="op">-</span> <span class="dv">1</span>) <span class="op">//</span> <span class="dv">2</span></span>
<span id="cb12-279"><a href="#cb12-279" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb12-280"><a href="#cb12-280" aria-hidden="true" tabindex="-1"></a>                    n <span class="op">+=</span> len1 <span class="op">*</span> len2</span>
<span id="cb12-281"><a href="#cb12-281" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> n</span>
<span id="cb12-282"><a href="#cb12-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-283"><a href="#cb12-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-284"><a href="#cb12-284" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> animate_balls_and_segments(</span>
<span id="cb12-285"><a href="#cb12-285" aria-hidden="true" tabindex="-1"></a>    fig,</span>
<span id="cb12-286"><a href="#cb12-286" aria-hidden="true" tabindex="-1"></a>    ax: Axes,</span>
<span id="cb12-287"><a href="#cb12-287" aria-hidden="true" tabindex="-1"></a>    circles: Circle,</span>
<span id="cb12-288"><a href="#cb12-288" aria-hidden="true" tabindex="-1"></a>    segments: Segment,</span>
<span id="cb12-289"><a href="#cb12-289" aria-hidden="true" tabindex="-1"></a>    c_pos: Iterable[Position],</span>
<span id="cb12-290"><a href="#cb12-290" aria-hidden="true" tabindex="-1"></a>    s_pos: Position,</span>
<span id="cb12-291"><a href="#cb12-291" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> HTML:</span>
<span id="cb12-292"><a href="#cb12-292" aria-hidden="true" tabindex="-1"></a>    camera <span class="op">=</span> Camera(fig)</span>
<span id="cb12-293"><a href="#cb12-293" aria-hidden="true" tabindex="-1"></a>    circle_list <span class="op">=</span> circles.tolist()</span>
<span id="cb12-294"><a href="#cb12-294" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Lower left</span></span>
<span id="cb12-295"><a href="#cb12-295" aria-hidden="true" tabindex="-1"></a>    segment_ll <span class="op">=</span> s_pos.transform(</span>
<span id="cb12-296"><a href="#cb12-296" aria-hidden="true" tabindex="-1"></a>        jnp.stack((<span class="op">-</span>segments.length <span class="op">*</span> <span class="fl">0.5</span>, jnp.zeros_like(segments.length)), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb12-297"><a href="#cb12-297" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-298"><a href="#cb12-298" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> pi <span class="kw">in</span> c_pos:</span>
<span id="cb12-299"><a href="#cb12-299" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> pij, circle <span class="kw">in</span> <span class="bu">zip</span>(pi.tolist(), circle_list):</span>
<span id="cb12-300"><a href="#cb12-300" aria-hidden="true" tabindex="-1"></a>            circle_patch <span class="op">=</span> CirclePatch(</span>
<span id="cb12-301"><a href="#cb12-301" aria-hidden="true" tabindex="-1"></a>                xy<span class="op">=</span>pij.xy,</span>
<span id="cb12-302"><a href="#cb12-302" aria-hidden="true" tabindex="-1"></a>                radius<span class="op">=</span>circle.radius,</span>
<span id="cb12-303"><a href="#cb12-303" aria-hidden="true" tabindex="-1"></a>                fill<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb12-304"><a href="#cb12-304" aria-hidden="true" tabindex="-1"></a>                color<span class="op">=</span>circle.rgba.tolist(),</span>
<span id="cb12-305"><a href="#cb12-305" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb12-306"><a href="#cb12-306" aria-hidden="true" tabindex="-1"></a>            ax.add_patch(circle_patch)</span>
<span id="cb12-307"><a href="#cb12-307" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> ll, pj, segment <span class="kw">in</span> <span class="bu">zip</span>(segment_ll, s_pos.tolist(), segments.tolist()):</span>
<span id="cb12-308"><a href="#cb12-308" aria-hidden="true" tabindex="-1"></a>            rect_patch <span class="op">=</span> Rectangle(</span>
<span id="cb12-309"><a href="#cb12-309" aria-hidden="true" tabindex="-1"></a>                xy<span class="op">=</span>ll,</span>
<span id="cb12-310"><a href="#cb12-310" aria-hidden="true" tabindex="-1"></a>                width<span class="op">=</span>segment.length,</span>
<span id="cb12-311"><a href="#cb12-311" aria-hidden="true" tabindex="-1"></a>                angle<span class="op">=</span>(pj.angle <span class="op">/</span> jnp.pi).item() <span class="op">*</span> <span class="dv">180</span>,</span>
<span id="cb12-312"><a href="#cb12-312" aria-hidden="true" tabindex="-1"></a>                height<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="cb12-313"><a href="#cb12-313" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb12-314"><a href="#cb12-314" aria-hidden="true" tabindex="-1"></a>            ax.add_patch(rect_patch)</span>
<span id="cb12-315"><a href="#cb12-315" aria-hidden="true" tabindex="-1"></a>        camera.snap()</span>
<span id="cb12-316"><a href="#cb12-316" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> HTML(camera.animate().to_html5_video())</span>
<span id="cb12-317"><a href="#cb12-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-318"><a href="#cb12-318" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> solve_constraints(</span>
<span id="cb12-319"><a href="#cb12-319" aria-hidden="true" tabindex="-1"></a>    space: Space,</span>
<span id="cb12-320"><a href="#cb12-320" aria-hidden="true" tabindex="-1"></a>    solver: VelocitySolver,</span>
<span id="cb12-321"><a href="#cb12-321" aria-hidden="true" tabindex="-1"></a>    p: Position,</span>
<span id="cb12-322"><a href="#cb12-322" aria-hidden="true" tabindex="-1"></a>    v: Velocity,</span>
<span id="cb12-323"><a href="#cb12-323" aria-hidden="true" tabindex="-1"></a>    contact_with_meta: ContactWithMetadata,</span>
<span id="cb12-324"><a href="#cb12-324" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> <span class="bu">tuple</span>[Velocity, Position, VelocitySolver]:</span>
<span id="cb12-325"><a href="#cb12-325" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Resolve collisions by Sequential Impulse method"""</span></span>
<span id="cb12-326"><a href="#cb12-326" aria-hidden="true" tabindex="-1"></a>    outer, inner <span class="op">=</span> contact_with_meta.outer_index, contact_with_meta.inner_index</span>
<span id="cb12-327"><a href="#cb12-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-328"><a href="#cb12-328" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_pairs(p_or_v: _PositionLike) <span class="op">-&gt;</span> <span class="bu">tuple</span>[_PositionLike, _PositionLike]:</span>
<span id="cb12-329"><a href="#cb12-329" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> p_or_v.get_slice(outer), p_or_v.get_slice(inner)</span>
<span id="cb12-330"><a href="#cb12-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-331"><a href="#cb12-331" aria-hidden="true" tabindex="-1"></a>    p1, p2 <span class="op">=</span> get_pairs(p)</span>
<span id="cb12-332"><a href="#cb12-332" aria-hidden="true" tabindex="-1"></a>    v1, v2 <span class="op">=</span> get_pairs(v)</span>
<span id="cb12-333"><a href="#cb12-333" aria-hidden="true" tabindex="-1"></a>    helper <span class="op">=</span> init_contact_helper(</span>
<span id="cb12-334"><a href="#cb12-334" aria-hidden="true" tabindex="-1"></a>        space,</span>
<span id="cb12-335"><a href="#cb12-335" aria-hidden="true" tabindex="-1"></a>        contact_with_meta.contact,</span>
<span id="cb12-336"><a href="#cb12-336" aria-hidden="true" tabindex="-1"></a>        contact_with_meta.shape1,</span>
<span id="cb12-337"><a href="#cb12-337" aria-hidden="true" tabindex="-1"></a>        contact_with_meta.shape2,</span>
<span id="cb12-338"><a href="#cb12-338" aria-hidden="true" tabindex="-1"></a>        p1,</span>
<span id="cb12-339"><a href="#cb12-339" aria-hidden="true" tabindex="-1"></a>        p2,</span>
<span id="cb12-340"><a href="#cb12-340" aria-hidden="true" tabindex="-1"></a>        v1,</span>
<span id="cb12-341"><a href="#cb12-341" aria-hidden="true" tabindex="-1"></a>        v2,</span>
<span id="cb12-342"><a href="#cb12-342" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-343"><a href="#cb12-343" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Warm up the velocity solver</span></span>
<span id="cb12-344"><a href="#cb12-344" aria-hidden="true" tabindex="-1"></a>    solver <span class="op">=</span> apply_initial_impulse(</span>
<span id="cb12-345"><a href="#cb12-345" aria-hidden="true" tabindex="-1"></a>        contact_with_meta.contact,</span>
<span id="cb12-346"><a href="#cb12-346" aria-hidden="true" tabindex="-1"></a>        helper,</span>
<span id="cb12-347"><a href="#cb12-347" aria-hidden="true" tabindex="-1"></a>        solver.replace(v1<span class="op">=</span>v1, v2<span class="op">=</span>v2),</span>
<span id="cb12-348"><a href="#cb12-348" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-349"><a href="#cb12-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-350"><a href="#cb12-350" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> vstep(</span>
<span id="cb12-351"><a href="#cb12-351" aria-hidden="true" tabindex="-1"></a>        _n_iter: <span class="bu">int</span>,</span>
<span id="cb12-352"><a href="#cb12-352" aria-hidden="true" tabindex="-1"></a>        vs: <span class="bu">tuple</span>[Velocity, VelocitySolver],</span>
<span id="cb12-353"><a href="#cb12-353" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">-&gt;</span> <span class="bu">tuple</span>[Velocity, VelocitySolver]:</span>
<span id="cb12-354"><a href="#cb12-354" aria-hidden="true" tabindex="-1"></a>        v_i, solver_i <span class="op">=</span> vs</span>
<span id="cb12-355"><a href="#cb12-355" aria-hidden="true" tabindex="-1"></a>        solver_i1 <span class="op">=</span> apply_velocity_normal(contact_with_meta.contact, helper, solver_i)</span>
<span id="cb12-356"><a href="#cb12-356" aria-hidden="true" tabindex="-1"></a>        v_i1 <span class="op">=</span> contact_with_meta.gather_p_or_v(solver_i1.v1, solver_i1.v2, v_i) <span class="op">+</span> v_i</span>
<span id="cb12-357"><a href="#cb12-357" aria-hidden="true" tabindex="-1"></a>        v1, v2 <span class="op">=</span> get_pairs(v_i1)</span>
<span id="cb12-358"><a href="#cb12-358" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> v_i1, solver_i1.replace(v1<span class="op">=</span>v1, v2<span class="op">=</span>v2)</span>
<span id="cb12-359"><a href="#cb12-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-360"><a href="#cb12-360" aria-hidden="true" tabindex="-1"></a>    v, solver <span class="op">=</span> fake_fori_loop(<span class="dv">0</span>, <span class="dv">4</span>, vstep, (v, solver))</span>
<span id="cb12-361"><a href="#cb12-361" aria-hidden="true" tabindex="-1"></a>    bv1, bv2 <span class="op">=</span> apply_bounce(contact_with_meta.contact, helper, solver)</span>
<span id="cb12-362"><a href="#cb12-362" aria-hidden="true" tabindex="-1"></a>    v <span class="op">=</span> contact_with_meta.gather_p_or_v(bv1, bv2, v) <span class="op">+</span> v</span>
<span id="cb12-363"><a href="#cb12-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-364"><a href="#cb12-364" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> pstep(</span>
<span id="cb12-365"><a href="#cb12-365" aria-hidden="true" tabindex="-1"></a>        _n_iter: <span class="bu">int</span>,</span>
<span id="cb12-366"><a href="#cb12-366" aria-hidden="true" tabindex="-1"></a>        ps: <span class="bu">tuple</span>[Position, PositionSolver],</span>
<span id="cb12-367"><a href="#cb12-367" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">-&gt;</span> <span class="bu">tuple</span>[Position, PositionSolver]:</span>
<span id="cb12-368"><a href="#cb12-368" aria-hidden="true" tabindex="-1"></a>        p_i, solver_i <span class="op">=</span> ps</span>
<span id="cb12-369"><a href="#cb12-369" aria-hidden="true" tabindex="-1"></a>        solver_i1 <span class="op">=</span> correct_position(</span>
<span id="cb12-370"><a href="#cb12-370" aria-hidden="true" tabindex="-1"></a>            space.bias_factor,</span>
<span id="cb12-371"><a href="#cb12-371" aria-hidden="true" tabindex="-1"></a>            space.linear_slop,</span>
<span id="cb12-372"><a href="#cb12-372" aria-hidden="true" tabindex="-1"></a>            space.max_linear_correction,</span>
<span id="cb12-373"><a href="#cb12-373" aria-hidden="true" tabindex="-1"></a>            contact_with_meta.contact,</span>
<span id="cb12-374"><a href="#cb12-374" aria-hidden="true" tabindex="-1"></a>            helper,</span>
<span id="cb12-375"><a href="#cb12-375" aria-hidden="true" tabindex="-1"></a>            solver_i,</span>
<span id="cb12-376"><a href="#cb12-376" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb12-377"><a href="#cb12-377" aria-hidden="true" tabindex="-1"></a>        p_i1 <span class="op">=</span> contact_with_meta.gather_p_or_v(solver_i1.p1, solver_i1.p2, p_i) <span class="op">+</span> p_i</span>
<span id="cb12-378"><a href="#cb12-378" aria-hidden="true" tabindex="-1"></a>        p1, p2 <span class="op">=</span> get_pairs(p_i1)</span>
<span id="cb12-379"><a href="#cb12-379" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> p_i1, solver_i1.replace(p1<span class="op">=</span>p1, p2<span class="op">=</span>p2)</span>
<span id="cb12-380"><a href="#cb12-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-381"><a href="#cb12-381" aria-hidden="true" tabindex="-1"></a>    pos_solver <span class="op">=</span> PositionSolver(</span>
<span id="cb12-382"><a href="#cb12-382" aria-hidden="true" tabindex="-1"></a>        p1<span class="op">=</span>p1,</span>
<span id="cb12-383"><a href="#cb12-383" aria-hidden="true" tabindex="-1"></a>        p2<span class="op">=</span>p2,</span>
<span id="cb12-384"><a href="#cb12-384" aria-hidden="true" tabindex="-1"></a>        contact<span class="op">=</span>solver.contact,</span>
<span id="cb12-385"><a href="#cb12-385" aria-hidden="true" tabindex="-1"></a>        min_separation<span class="op">=</span>jnp.zeros_like(p1.angle),</span>
<span id="cb12-386"><a href="#cb12-386" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-387"><a href="#cb12-387" aria-hidden="true" tabindex="-1"></a>    p, pos_solver <span class="op">=</span> jax.lax.fori_loop(<span class="dv">0</span>, space.n_position_iter, pstep, (p, pos_solver))</span>
<span id="cb12-388"><a href="#cb12-388" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> v, p, solver</span>
<span id="cb12-389"><a href="#cb12-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-390"><a href="#cb12-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-391"><a href="#cb12-391" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dont_solve_constraints(</span>
<span id="cb12-392"><a href="#cb12-392" aria-hidden="true" tabindex="-1"></a>    _space: Space,</span>
<span id="cb12-393"><a href="#cb12-393" aria-hidden="true" tabindex="-1"></a>    solver: VelocitySolver,</span>
<span id="cb12-394"><a href="#cb12-394" aria-hidden="true" tabindex="-1"></a>    p: Position,</span>
<span id="cb12-395"><a href="#cb12-395" aria-hidden="true" tabindex="-1"></a>    v: Velocity,</span>
<span id="cb12-396"><a href="#cb12-396" aria-hidden="true" tabindex="-1"></a>    _contact_with_meta: ContactWithMetadata,</span>
<span id="cb12-397"><a href="#cb12-397" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> <span class="bu">tuple</span>[Velocity, Position, VelocitySolver]:</span>
<span id="cb12-398"><a href="#cb12-398" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> v, p, solver</span>
<span id="cb12-399"><a href="#cb12-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-400"><a href="#cb12-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-401"><a href="#cb12-401" aria-hidden="true" tabindex="-1"></a>N_SEG <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb12-402"><a href="#cb12-402" aria-hidden="true" tabindex="-1"></a>segments <span class="op">=</span> Segment(</span>
<span id="cb12-403"><a href="#cb12-403" aria-hidden="true" tabindex="-1"></a>    mass<span class="op">=</span>jnp.ones(N_SEG) <span class="op">*</span> jnp.inf,</span>
<span id="cb12-404"><a href="#cb12-404" aria-hidden="true" tabindex="-1"></a>    moment<span class="op">=</span>jnp.ones(N_SEG) <span class="op">*</span> jnp.inf,</span>
<span id="cb12-405"><a href="#cb12-405" aria-hidden="true" tabindex="-1"></a>    elasticity<span class="op">=</span>jnp.ones(N_SEG) <span class="op">*</span> <span class="fl">0.5</span>,</span>
<span id="cb12-406"><a href="#cb12-406" aria-hidden="true" tabindex="-1"></a>    friction<span class="op">=</span>jnp.ones(N_SEG) <span class="op">*</span> <span class="fl">1.0</span>,</span>
<span id="cb12-407"><a href="#cb12-407" aria-hidden="true" tabindex="-1"></a>    rgba<span class="op">=</span>jnp.ones((N_SEG, <span class="dv">4</span>)),</span>
<span id="cb12-408"><a href="#cb12-408" aria-hidden="true" tabindex="-1"></a>    length<span class="op">=</span>jnp.array([<span class="dv">4</span> <span class="op">*</span> jnp.sqrt(<span class="dv">2</span>), <span class="dv">4</span>, <span class="dv">4</span> <span class="op">*</span> jnp.sqrt(<span class="dv">2</span>)]),</span>
<span id="cb12-409"><a href="#cb12-409" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-410"><a href="#cb12-410" aria-hidden="true" tabindex="-1"></a>cpos <span class="op">=</span> jnp.array([[<span class="dv">2</span>, <span class="dv">2</span>], [<span class="dv">4</span>, <span class="dv">3</span>], [<span class="dv">3</span>, <span class="dv">6</span>], [<span class="dv">6</span>, <span class="dv">5</span>], [<span class="dv">5</span>, <span class="dv">7</span>]], dtype<span class="op">=</span>jnp.float32)</span>
<span id="cb12-411"><a href="#cb12-411" aria-hidden="true" tabindex="-1"></a>stated <span class="op">=</span> StateDict(</span>
<span id="cb12-412"><a href="#cb12-412" aria-hidden="true" tabindex="-1"></a>    circle<span class="op">=</span>State(</span>
<span id="cb12-413"><a href="#cb12-413" aria-hidden="true" tabindex="-1"></a>        p<span class="op">=</span>Position(xy<span class="op">=</span>cpos, angle<span class="op">=</span>jnp.zeros(N)),</span>
<span id="cb12-414"><a href="#cb12-414" aria-hidden="true" tabindex="-1"></a>        v<span class="op">=</span>Velocity.zeros(N),</span>
<span id="cb12-415"><a href="#cb12-415" aria-hidden="true" tabindex="-1"></a>        f<span class="op">=</span>Force.zeros(N),</span>
<span id="cb12-416"><a href="#cb12-416" aria-hidden="true" tabindex="-1"></a>        is_active<span class="op">=</span>jnp.array([<span class="va">True</span>, <span class="va">True</span>, <span class="va">True</span>, <span class="va">True</span>, <span class="va">True</span>]),</span>
<span id="cb12-417"><a href="#cb12-417" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb12-418"><a href="#cb12-418" aria-hidden="true" tabindex="-1"></a>    segment<span class="op">=</span>State(</span>
<span id="cb12-419"><a href="#cb12-419" aria-hidden="true" tabindex="-1"></a>        p<span class="op">=</span>Position(</span>
<span id="cb12-420"><a href="#cb12-420" aria-hidden="true" tabindex="-1"></a>            xy<span class="op">=</span>jnp.array([[<span class="op">-</span><span class="fl">2.0</span>, <span class="fl">2.0</span>], [<span class="dv">2</span>, <span class="dv">0</span>], [<span class="dv">6</span>, <span class="dv">2</span>]], dtype<span class="op">=</span>jnp.float32),</span>
<span id="cb12-421"><a href="#cb12-421" aria-hidden="true" tabindex="-1"></a>            angle<span class="op">=</span>jnp.array([jnp.pi <span class="op">*</span> <span class="fl">1.75</span>, <span class="dv">0</span>, jnp.pi <span class="op">*</span> <span class="fl">0.25</span>]),</span>
<span id="cb12-422"><a href="#cb12-422" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb12-423"><a href="#cb12-423" aria-hidden="true" tabindex="-1"></a>        v<span class="op">=</span>Velocity.zeros(N_SEG),</span>
<span id="cb12-424"><a href="#cb12-424" aria-hidden="true" tabindex="-1"></a>        f<span class="op">=</span>Force.zeros(N_SEG),</span>
<span id="cb12-425"><a href="#cb12-425" aria-hidden="true" tabindex="-1"></a>        is_active<span class="op">=</span>jnp.ones(N_SEG, dtype<span class="op">=</span><span class="bu">bool</span>),</span>
<span id="cb12-426"><a href="#cb12-426" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb12-427"><a href="#cb12-427" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-428"><a href="#cb12-428" aria-hidden="true" tabindex="-1"></a>space <span class="op">=</span> ExtendedSpace(</span>
<span id="cb12-429"><a href="#cb12-429" aria-hidden="true" tabindex="-1"></a>    gravity<span class="op">=</span>jnp.array([<span class="fl">0.0</span>, <span class="op">-</span><span class="fl">9.8</span>]),</span>
<span id="cb12-430"><a href="#cb12-430" aria-hidden="true" tabindex="-1"></a>    linear_damping<span class="op">=</span><span class="fl">1.0</span>,</span>
<span id="cb12-431"><a href="#cb12-431" aria-hidden="true" tabindex="-1"></a>    angular_damping<span class="op">=</span><span class="fl">1.0</span>,</span>
<span id="cb12-432"><a href="#cb12-432" aria-hidden="true" tabindex="-1"></a>    dt<span class="op">=</span><span class="fl">0.04</span>,</span>
<span id="cb12-433"><a href="#cb12-433" aria-hidden="true" tabindex="-1"></a>    bias_factor<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb12-434"><a href="#cb12-434" aria-hidden="true" tabindex="-1"></a>    shaped<span class="op">=</span>ShapeDict(circle<span class="op">=</span>circles, segment<span class="op">=</span>segments),</span>
<span id="cb12-435"><a href="#cb12-435" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-436"><a href="#cb12-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-437"><a href="#cb12-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-438"><a href="#cb12-438" aria-hidden="true" tabindex="-1"></a><span class="at">@jax.jit</span></span>
<span id="cb12-439"><a href="#cb12-439" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> step(stated: StateDict, solver: VelocitySolver) <span class="op">-&gt;</span> StateDict:</span>
<span id="cb12-440"><a href="#cb12-440" aria-hidden="true" tabindex="-1"></a>    state <span class="op">=</span> update_velocity(space, space.shaped.concat(), stated.concat())</span>
<span id="cb12-441"><a href="#cb12-441" aria-hidden="true" tabindex="-1"></a>    contact_with_meta <span class="op">=</span> space.check_contacts(stated.update(state))</span>
<span id="cb12-442"><a href="#cb12-442" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check there's any penetration</span></span>
<span id="cb12-443"><a href="#cb12-443" aria-hidden="true" tabindex="-1"></a>    contacts <span class="op">=</span> contact_with_meta.contact.penetration <span class="op">&gt;=</span> <span class="dv">0</span></span>
<span id="cb12-444"><a href="#cb12-444" aria-hidden="true" tabindex="-1"></a>    v, p, solver <span class="op">=</span> jax.lax.cond(</span>
<span id="cb12-445"><a href="#cb12-445" aria-hidden="true" tabindex="-1"></a>        jnp.<span class="bu">any</span>(contacts),</span>
<span id="cb12-446"><a href="#cb12-446" aria-hidden="true" tabindex="-1"></a>        solve_constraints,</span>
<span id="cb12-447"><a href="#cb12-447" aria-hidden="true" tabindex="-1"></a>        dont_solve_constraints,</span>
<span id="cb12-448"><a href="#cb12-448" aria-hidden="true" tabindex="-1"></a>        space,</span>
<span id="cb12-449"><a href="#cb12-449" aria-hidden="true" tabindex="-1"></a>        solver.update(contacts),</span>
<span id="cb12-450"><a href="#cb12-450" aria-hidden="true" tabindex="-1"></a>        state.p,</span>
<span id="cb12-451"><a href="#cb12-451" aria-hidden="true" tabindex="-1"></a>        state.v,</span>
<span id="cb12-452"><a href="#cb12-452" aria-hidden="true" tabindex="-1"></a>        contact_with_meta,</span>
<span id="cb12-453"><a href="#cb12-453" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-454"><a href="#cb12-454" aria-hidden="true" tabindex="-1"></a>    statec <span class="op">=</span> update_position(space, state.replace(v<span class="op">=</span>v, p<span class="op">=</span>p))</span>
<span id="cb12-455"><a href="#cb12-455" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> stated.update(statec)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>アニメーションしてみます。</p>
<div class="cell" data-tags="[]" data-execution_count="61">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>positions <span class="op">=</span> [stated[<span class="st">"circle"</span>].p]</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>solver <span class="op">=</span> init_solver(space.n_possible_contacts())</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">50</span>):</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    stated <span class="op">=</span> step(stated, solver)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    positions.append(stated[<span class="st">"circle"</span>].p)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>ax.set_aspect(<span class="st">"equal"</span>, adjustable<span class="op">=</span><span class="st">"box"</span>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>ax.set_xlim((<span class="op">-</span><span class="dv">10</span>, <span class="dv">10</span>))</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>ax.set_ylim((<span class="dv">0</span>, <span class="dv">10</span>))</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>animate_balls_and_segments(</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    fig,</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    ax,</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    space.shaped[<span class="st">"circle"</span>],</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    space.shaped[<span class="st">"segment"</span>],</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    positions,</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    stated[<span class="st">"segment"</span>].p,</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="61">
<video width="640" height="480" controls="" autoplay="" loop="">
  <source type="video/mp4" src="data:video/mp4;base64,AAAAIGZ0eXBNNFYgAAACAE00ViBpc29taXNvMmF2YzEAAAAIZnJlZQAAtWhtZGF0AAACrgYF//+q
3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE2NCByMzA5NSBiYWVlNDAwIC0gSC4yNjQvTVBF
Ry00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAyMiAtIGh0dHA6Ly93d3cudmlkZW9sYW4u
b3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTMgZGVibG9jaz0xOjA6MCBhbmFs
eXNlPTB4MzoweDExMyBtZT1oZXggc3VibWU9NyBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVk
X3JlZj0xIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MSA4eDhkY3Q9MSBjcW09MCBk
ZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0tMiB0aHJlYWRzPTE1
IGxvb2thaGVhZF90aHJlYWRzPTIgc2xpY2VkX3RocmVhZHM9MCBucj0wIGRlY2ltYXRlPTEgaW50
ZXJsYWNlZD0wIGJsdXJheV9jb21wYXQ9MCBjb25zdHJhaW5lZF9pbnRyYT0wIGJmcmFtZXM9MyBi
X3B5cmFtaWQ9MiBiX2FkYXB0PTEgYl9iaWFzPTAgZGlyZWN0PTEgd2VpZ2h0Yj0xIG9wZW5fZ29w
PTAgd2VpZ2h0cD0yIGtleWludD0yNTAga2V5aW50X21pbj01IHNjZW5lY3V0PTQwIGludHJhX3Jl
ZnJlc2g9MCByY19sb29rYWhlYWQ9NDAgcmM9Y3JmIG1idHJlZT0xIGNyZj0yMy4wIHFjb21wPTAu
NjAgcXBtaW49MCBxcG1heD02OSBxcHN0ZXA9NCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAk
L2WIhAAR//73iB8yy2n5OtdyEegf/bXeEyzaO1hHRRsrYAAAAwAAAwAAF4oxxkv+3lw3OAAAAwE8
AC6hCwhoYIdwDeYUXvk3uADz6sXq1EN/WFn9LLKQFLW7xRHevkHUQg/aJnyMYp/nDfuWTpdzSbSh
0agkf9HmPhGQ0JGcEsaFxLy7vO2YuzbfoqXZ2XbxhL/sERHvrps4XyZ2HVA0RkIxNg1obs3ABm1F
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
My4xMDA=
">
  Your browser does not support the video tag.
</video>
</div>
</div>
<p>ちょっとめりこんでいますがまあ一応計算できてはいそうです。一応簡単にベンチマークしてみます。</p>
<div class="cell" data-tags="[]" data-execution_count="62">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit step(stated, solver)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>611 µs ± 12.8 µs per loop (mean ± std. dev. of 7 runs, 1,000 loops each)</code></pre>
</div>
</div>
<p>ボールの数がまだ少ないですが、1ステップあたり566マイクロ秒ということで、かなり高速にできたのではないでしょうか。</p>
</section>
</section>
<section id="まとめ" class="level1">
<h1>まとめ</h1>
<p>この記事では、jaxを使って高速な2次元物理シミュレーションを書くことに挑戦しました。結果、かなり高速にできましたが、デバッグが非常に難しく苦戦しました。具体的にいうと、</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _sv_cross(s: jax.Array, v: jax.Array) <span class="op">-&gt;</span> jax.Array:</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Cross product with scalar and vector"""</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    x, y <span class="op">=</span> _get_xy(v)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> jnp.stack((y <span class="op">*</span> <span class="op">-</span>s, x <span class="op">*</span> s), axis<span class="op">=-</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>という関数があるのですが、このxとyが逆になっていて、衝突時に謎のインパルスが発生していてかなり困っていました。最終的に物体が真横にぶつかってるのに角速度由来のインパルスが横に発生してるのはおかしくね？という気付きを得てどうにかなりましたが…、物理が苦手すぎるなあ。</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>